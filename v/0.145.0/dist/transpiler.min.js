"use strict";var _slicedToArray=function(){function e(e,t){var r=[],a=!0,s=!1,o=void 0;try{for(var n,p=e[Symbol.iterator]();!(a=(n=p.next()).done)&&(r.push(n.value),!(t&&r.length===t));a=!0);}catch(e){s=!0,o=e}finally{try{!a&&p["return"]&&p["return"]()}finally{if(s)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}!function(e){"function"==typeof define&&define.amd?define(e):window.Transpiler=e()}(function(){function hash(e){for(var t=0,r=0;r<e.length;r++)t+=16777619*e.charCodeAt(r);return t}function now(){return performance.now?performance.now():new Date().getTime()}function uniq(e){return e.filter(function(t,r){return e.indexOf(t)==r})}function stringify(e){return"\""+e.replace(/(\r?\n)|([\\"])/gm,function(e,t,r){return t?"\\n\\\n":"\\"+r})+"\""}function ParserError(e,t,r){var a=new Error(e,t,r);return Object.setPrototypeOf?Object.setPrototypeOf(a,Object.getPrototypeOf(this)):a.__proto__=this.__proto__,Error.captureStackTrace&&Error.captureStackTrace(a,ParserError),a}function Parser(e,t){this.index=0,this.input=e,this.last=void 0,this.lastIndex=void 0,this.parseTemplateLiteral=null,this.parentheses=[],this.lastParenthesis=void 0,this.options=Polyfill.assign({},defaultOptions),this.from=t||{}}function Generated(e){this.transpiler=e,this.scope={context:0,children:[]},this.fun,this.data=[],this.uses={}}function defineMode(e,t,r){var a=modeRegistry.length;return modeRegistry.push({name:e[0],parser:t}),e.forEach(function(e){modeNames[e]=a}),r&&(defaultMode=a),a}function startMode(e,t,r,a,s,o){var n=modeRegistry[e],p=new n.parser(t,r,a,s||{},o);return p.options=r.options=n.parser.getOptions(),p}function Mode(e,t,r,a){this.transpiler=e,this.parser=t,this.source=r,this.runtime=e.runtime,this.es6=e.options.es6,this.attributes=a}function BreakpointMode(e,t,r,a,s){Mode.call(this,e,t,r,a),this.breakpoints=["<"].concat(s)}function TextExprMode(e,t,r,a){Mode.call(this,e,t,r,a),this.current=[],this.chain=[],this.chainable=!0}function LogicMode(e,t,r,a){TextExprMode.call(this,e,t,r,a),this.count=0,this.statements=[],this.popped=[]}function OptionalLogicMode(e,t,r,a){LogicMode.call(this,e,t,r,a),a.logic||(this.parse=TextExprMode.prototype.parse.bind(this))}function SourceCodeMode(e,t,r,a){BreakpointMode.call(this,e,t,r,a,["(",")","{","}","$","&","*","^"]),this.observables=[],this.maybeObservables=[],this.parentheses=[]}function AutoSourceCodeMode(e,t,r,a){SourceCodeMode.call(this,e,t,r,a)}function HTMLMode(e,t,r,a){OptionalLogicMode.call(this,e,t,r,a)}function AutoHTMLMode(e,t,r,a,s){HTMLMode.call(this,e,t,r,s&&s.attributes||a)}function ScriptMode(e,t,r,a){TextExprMode.call(this,e,t,r,a),this.scope=!!a.scoped&&e.nextId(),this.scope&&this.pushText("!function(){")}function CSSMode(e,t,r,a){OptionalLogicMode.call(this,e,t,r,a)}function SSBMode(e,t,r,a){LogicMode.call(this,e,t,r,a),this.observables=[],this.maybeObservables=[],this.expr=[],this.scopes=[e.value],this.scope=a.scope&&JSON.stringify(a.scope),this.scoped=!!a.scoped,this.inExpr=!1}function HTMLCommentMode(e,t,r,a){TextExprMode.call(this,e,t,r,a),this.values=[]}function mapAttributeType(e){return""===e?Attr.NONE:"@"===e?Attr.PROP:"&"===e?Attr.STYLE:"+"===e?Attr.EVENT:"$"===e?Attr.WIDGET:"~"===e?Attr.UPDATE_WIDGET:"$$"===e?Attr.EXTEND_WIDGET:void 0}function Transpiler(e){var t=this;if(this.options=Polyfill.assign({env:["none"]},e||{}),this.options.mode){var r=this.options.mode.indexOf("@");if(-1!=r){var a=this.options.mode.substr(r+1).split(",");this.options.mode=this.options.mode.substring(0,r),"object"!=_typeof(this.options.modeAttributes)&&(this.options.modeAttributes={}),a.forEach(function(e){"!"==e.charAt(0)?t.options.modeAttributes[e.substr(1)]=!1:t.options.modeAttributes[e]=!0})}}Array.isArray(this.options.env)||(this.options.env=[this.options.env]),this.options.sandboxed||1!=this.options.env.length||"none"!=this.options.env[0]?this.options.env.forEach(function(e){if(-1==["none","amd","commonjs"].indexOf(e))throw new Error("Unknown env '"+e+"'.")}):this.nextVar=Transpiler.prototype.nextVarName.bind(this),this.options.latin&&(this.nextVar=this.nextVarName=Transpiler.prototype.nextLatinVarName.bind(this))}function evalScripts(){Array.prototype.forEach.call(document.querySelectorAll("script[type='text/sactory'], script[type='text/x-sactory']"),function(e){var t=count++ +"";e.setAttribute("data-sactory-from",t),e.setAttribute("data-to","[data-sactory-to='"+t+"']");var r=document.createElement("script");r.setAttribute("data-sactory-to",t),r.setAttribute("data-from","[data-sactory-from='"+t+"']");var a={};Array.prototype.forEach.call(e.attributes,function(e){Polyfill.startsWith.call(e.name,"mode:")&&(a[e.name.substr(5)]=!0)});var s=new Transpiler({namespace:t,mode:e.getAttribute("mode"),modeAttributes:a,es6:!1,before:"var $$script=document.querySelector(\"[data-sactory-from='"+t+"']\");",element:"$$script&&$$script.parentNode",anchor:"$$script&&$$script.nextSibling"});r.textContent=s.transpile(e.textContent).source.all,document.head.appendChild(r)})}var toString=function(){return Object.toString().replace(/Object/,"Transpiler").replace(/native/,"sactory")};Transpiler.toString=toString.toString=toString,Object.defineProperty(Transpiler,"VERSION",{value:"0.145.0"}),Object.defineProperty(Transpiler,"BUILT",{value:"2019-09-26T16:10:00.471Z"});var Polyfill={startsWith:String.prototype.startsWith||function(e,t){return t=!t||0>t?0:+t,this.substring(t,t+e.length)===e},endsWith:String.prototype.endsWith||function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e},trimStart:String.prototype.trimStart||function(){return this.replace(/^[\s\uFEFF\xA0]+/g,"")},trimEnd:String.prototype.trimEnd||function(){return this.replace(/[\s\uFEFF\xA0]+$/g,"")},padStart:String.prototype.padStart||function(e,t){for(var r=this+"";r.length<e;)r=t+r;return ret},assign:Object.assign||function(e){for(var t=arguments.length,r=Array(1<t?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];return r.forEach(function(t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}),e},trunc:Math.trunc||function(e){return e-e%1},find:Array.prototype.find||function(e){for(var t,r=0;r<this.length;r++)if(t=this[r],e(t,r,this))return t}},Attr={},def=function(e,t){return Object.defineProperty(Attr,e,{value:t})};def("NORMAL",0),def("INTERPOLATED",1),def("SPREAD",2),def("NONE",0),def("PROP",1),def("STYLE",2),def("EVENT",3),def("WIDGET",4),def("UPDATE_WIDGET",5),def("EXTEND_WIDGET",6),ParserError.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!1,configurable:!1}}),ParserError.prototype.name="ParserError";var defaultOptions={whitespaces:/\s/,comments:!1,inlineComments:!0,strings:!1,regexp:!1};Object.defineProperty(Parser.prototype,"position",{get:function a(){for(var e=0,t=0,r=0;r<=this.index;r++)"\n"==this.input.charAt(r)?(e++,t=-1):t++;return{absolute:this.index+(this.from&&this.from.absolute-this.input.length||0),index:this.index,line:e+(this.from&&this.from.line-(this.input.match(/\n/g)||[]).length||0),column:Math.max(0,t)+(this.from&&this.from.column-this.input.length||0)}}}),Parser.prototype.error=function(e){this.errorAt(this.position,e)},Parser.prototype.errorAt=function(e,t){var r=this.input.substr(e.index).indexOf("\n"),a=this.input.substring(0,e.index).lastIndexOf("\n")+1,s=-1==r?this.input.length:e.index+r;t+="\n"+this.input.substring(a,s)+"\n";for(var o=a;o<s;o++)t+=o==e.index?"^":"\t"==this.input.charAt(o)?"\t":" ";throw new ParserError("Line "+(e.line+1)+", Column "+e.column+": "+t)},Parser.prototype.eof=function(){return this.index>=this.input.length},Parser.prototype.peek=function(){return this.input[this.index]},Parser.prototype.read=function(){return this.input[this.index++]},Parser.prototype.readIf=function(e){if(this.peek()===e)return this.read()},Parser.prototype.expect=function(e){var t=this.input[this.index++];t!==e&&(this.index--,this.error("Expected `"+e+"` but got `"+t+"`."))},Parser.prototype.expectSequence=function(e){e==this.input.substr(this.index,e.length)?this.index+=e.length:this.error("Expected `"+e+"`.")},Parser.prototype.lastKeywordAt=function(e,t){return this.input.charAt(e)===t.charAt(t.length-1)&&this.input.substring(e-t.length+1,e+1)==t&&!/[a-zA-Z0-9_$.]/.test(this.input.charAt(e-t.length))},Parser.prototype.lastKeywordAtIn=function(e){for(var t=1;t<arguments.length;t++)if(this.lastKeywordAt(e,arguments[t]))return!0;return!1},Parser.prototype.lastKeyword=function(e){return this.lastKeywordAt(this.lastIndex,e)},Parser.prototype.lastKeywordIn=function(){for(var e=0;e<arguments.length;e++)if(this.lastKeyword(arguments[e]))return!0;return!1},Parser.prototype.lastKeywordIsPlusMinus=function(){return("+"==this.last||"-"==this.last)&&(this.input.charAt(this.lastIndex-1)!=this.last||!/[a-zA-Z0-9_$]\s*$/.test(this.input.substring(0,this.lastIndex-1)))},Parser.prototype.couldStartRegExp=function(){return void 0===this.last||!this.last.match(/^[a-zA-Z0-9_$'"`)\].+-]$/)||this.lastKeywordIn("return","throw","typeof","do","in","instanceof","new","delete","else")||")"==this.last&&this.lastParenthesis&&this.lastKeywordAtIn(this.lastParenthesis.lastIndex,"if","else","for","while","with")||/\n/.test(this.input.substring(this.lastIndex,this.index))&&this.lastKeywordIn("++","--","break","continue")||this.lastKeywordIsPlusMinus()},Parser.prototype.skipImpl=function(e){e=Polyfill.assign({},defaultOptions,e);for(var t=this.last,r=this.lastIndex,a="";!this.eof();){var s=this.peek(),o=void 0;if(e.whitespaces&&e.whitespaces.test(s))a+=this.read();else if(e.comments&&"/"==s&&("/"==(o=this.input[this.index+1])&&e.inlineComments||"*"==o))a+=this.read()+this.read()+("/"==o?this.findSequence("\n",!1):this.findSequence("*/",!1)),this.last=void 0;else if(e.strings&&("\""==s||"'"==s||"`"==s))a+=this.skipString(),t=this.last,r=this.index;else if(e.regexp&&"/"==s&&this.couldStartRegExp())a+=this.skipRegExp(),t=this.last,r=this.index;else{this.last=t,this.lastIndex=r;break}}return a},Parser.prototype.skip=function(){return this.skipImpl(this.options)},Parser.prototype.skipEscapableContent=function(e){var t=this.position,r=this.read(),a=["\\",r];"`"==r&&a.push("$");for(var s,o=r;!this.eof();)if(s=this.find(a,!1,!1),o+=s.pre,!s.match)this.error("Could not find end of "+e()+" started at line "+t.line+" column "+t.column);else if("\\"==s.match)o+="\\"+this.read();else if("$"==s.match&&"{"==this.peek()){var n=this.parseTemplateLiteral,p=this.skipEnclosedContent().slice(1,-1);o+="${"+("function"==typeof n?n(p,this):p)+"}"}else break;return o+r},Parser.prototype.skipString=function(){var e=this.skipEscapableContent(function(){return"string"});return this.last=this.input[this.lastIndex=this.index-1],e},Parser.prototype.skipRegExp=function(){for(var e,t=this.skipEscapableContent(function(){return"regular expression"}),r=["g","i","m","s","u","y"];-1!=(e=r.indexOf(this.peek()));)r.splice(e,1),t+=this.read();return this.lastIndex=this.index-1,this.last="a",t},Parser.prototype.skipEnclosedContent=function(e){this.lastEnclosureIndex=this.index;for(var t,r={"}":"{","]":"[",")":"("},a=this.last=this.read(),s={"{":0,"[":0,"(":0};!this.eof();){t=this.find(["{","}","[","]","(",")"],!0,{comments:!0,strings:!0,regexp:!0}),a+=t.pre+t.match;var o=r[t.match],n=s[t.match];if(!o)void 0!==n&&s[t.match]++;else if(s[o]--,0>s[o])return e?a.slice(1,-1):a}this.error("Expression not completed.")},Parser.prototype.find=function(e,t,r){for(var a="";!this.eof();){r&&(a+="object"==("undefined"==typeof r?"undefined":_typeof(r))?this.skipImpl(r):this.skip());var s=this.input[this.index++];if(-1!=e.indexOf(s))return{pre:a,match:s};s&&(a+=s),this.last=s,this.lastIndex=this.index-1}return t&&this.eof()&&(1==e.length?this.error("Expected `"+e[0]+"` but not found."):this.error("Expected one of "+e.map(function(e){return"`"+e+"`"}).join(", ")+", but not found.")),{pre:a}},Parser.prototype.findSequence=function(e,t){var r=this.input.substr(this.index).indexOf(e);-1==r&&(t?this.error("Could not find sequence `"+e+"`."):r=this.input.length);var a=this.input.substr(this.index,r+e.length);return this.index+=r+e.length,a},Parser.prototype.readImpl=function(e,t,r){var a=e.exec(this.input.substr(this.index));return a?(this.index+=a[0].length,a[0]):!!t&&void this.error(r&&r()||"Regular expression `"+e+"` could not be satisfied.")},Parser.prototype.readVarName=function(e){return this.readImpl(/^[a-zA-Z_$][a-zA-Z0-9_$]*/,e,function(){return"Could not find a valid variable name."})},Parser.prototype.readTagName=function(e){return this.readImpl(/^(#[a-z-]+|[a-zA-Z0-9$:-]+)/,e,function(){return"Could not find a valid tag name."})},Parser.prototype.readAttributePrefix=function(){var e=/^(?:([:@&*~+]|\$\$?)|(dir|bind|attr|prop|style|on|widget|update|extend):)/.exec(this.input.substr(this.index));return!!e&&(this.index+=e[0].length,e[1]||{dir:":",bind:"*",attr:"",prop:"@",style:"&",on:"+",widget:"$",update:"~",extend:"$$"}[e[2]])},Parser.prototype.readAttributeName=function(e){return this.readImpl(/^[a-zA-Z0-9_$@.:!-]+/,e,function(){return"Could not find a valid attribute name."})},Parser.prototype.readComputedExpr=function(){return"["==this.peek()&&this.skipEnclosedContent().slice(1,-1)},Parser.prototype.readQueryExpr=function(){var e=this.peek();return"{"==e?this.skipEnclosedContent().slice(1,-1):("\""==e||"'"==e||"`"==e)&&this.skipString()},Parser.prototype.readSingleExpression=function(e,t){var r=this.readImpl(/^([-+~!]*((new|delete|typeof)\s+)?(&|\*\*?\??|\^\??)?)/)||"";e&&(r+=this.skipImpl({comments:!0}));var a=this.peek();for(r+="\""==a||"'"==a||"`"==a?this.skipString():"/"==a?this.skipRegExp():this.readImpl(/^(([a-zA-Z_$][a-zA-Z0-9_$]*)|0[box][0-9]+|([0-9]*\.?[0-9]+([eE][+-]?[0-9]+)?))/,!1)||"";!this.eof();){var s={ret:r,index:this.index};e&&(r+=this.skipImpl({comments:!0}));var o=this.readImpl(/^(\.((\*\*?|\^)\??)?#?[a-zA-Z0-9_$]+)/,!1);if(o&&(r+=o,e&&(r+=this.skipImpl({comments:!0}))),a=this.peek(),"{"==a||"["==a||"("==a)r+=this.skipEnclosedContent();else if(!o){r=s.ret,this.index=s.index;break}}return a=this.peek(),("+"==a||"-"==a)&&this.input.charAt(this.index+1)==a&&(r+=this.read()+this.read()),t&&!r.length&&this.error("Could not find a valid expression."),r},Parser.prototype.readExpression=function(){var e,t=this.skipImpl({comments:!0});if(e=this.readSingleExpression(!0))for(t+=e+this.skipImpl({comments:!0});!this.eof()&&(e=this.readImpl(/^(\*\*|&&?|\|\|?|\^|=>|==?=?|!==?|<<|>>>?|\?|:|[+*/%<>-]=?|in(stanceof)?\s)/,!1));)t+=e+this.skipImpl({comments:!0}),(e=this.readSingleExpression(!0)).trim()||this.error("Could not find a valid expression."),t+=e+this.skipImpl({comments:!0});return t.trim().length?t:void this.error("Could not find a valid expression.")},Parser.prototype.readAttributeValue=function(){return this.readSingleExpression(!1)||this.error("Could not find a valid expression for the attribute's value.")},Parser.prototype.readVar=function(e){return"{"==this.peek()?"("+this.skipEnclosedContent().slice(1,-1)+")":this.readVarName(e)},Generated.prototype.fork=function(){var e=new Generated(this.transpiler);return e.scope.context=this.scope.context,e},Generated.prototype.tail=function(){return this.data[this.data.length-1]},Generated.prototype.add=function(e,t,r){var a;return r||!this.data.length||(a=this.data[this.data.length-1]).type?(a={type:r?"isolated":"",value:t},this.data.push(a)):a.value+=t,a},Generated.prototype.addSource=Generated.prototype.push=function(e,t){return this.add(0,e,t)},Generated.prototype.addIsolatedSource=function(e){return this.addSource(e,!0)},Generated.prototype.injectFunctionContext=function(e){var t=this;if(!e.injected){e.injected=!0;var r,a=0,s=e.args.split(",");s.length&&(s=s.map(function(e){return e.trim()}),!s[s.length-1].length&&s.pop(),s.forEach(function(e){r?e.charAt(e.length-1)==r&&(r=!1,a++):"{"==e.charAt(0)?r="}":"["==e.charAt(0)?r="]":a++}));var o=function(e){return t.transpiler["context"+e]};e.data.value="var "+o(e.context)+"="+this.transpiler.runtime+".cfa("+o(e.prevContext)+", arguments, "+a+");"}},Generated.prototype.addContext=function(){this.addSource(this.getContext())},Generated.prototype.getContext=function(){if(this.uses.context=!0,this.fun){var e="context"+this.fun.context,t=this.fun;do t.fun&&this.injectFunctionContext(t);while(t=t.parent);return this.transpiler[e]}return this.transpiler.context0},Generated.prototype.startScope=function(e){var t={parent:this.scope,context:this.scope.context,prevContext:this.scope.prevContext,children:[],after:e};this.scope.children.push(t),this.scope=t},Generated.prototype.startFunction=function(e){var t={parent:this.scope,prevContext:this.scope.context,context:(this.scope.context+1)%2,children:[],data:this.addIsolatedSource(""),fun:!0,args:e};this.scope.children.push(t),this.scope=this.fun=t},Generated.prototype.endScope=function(){if(this.scope.fun){for(var e=this.scope.parent;e&&!e.fun;)e=e.parent;this.fun=e}this.scope.after&&this.addSource(this.scope.after),this.scope=this.scope.parent},Generated.prototype.toString=function(){return this.data.map(function(e){return e.value}).join("")};var defaultMode,modeRegistry=[],modeNames={};Mode.prototype.usedAttributes=function(){return[]},Mode.prototype.add=function(e){return this.source.push(e)},Mode.prototype.parseCode=function(e){this.parser.parseTemplateLiteral=null;var t=Parser.prototype[e].apply(this.parser,Array.prototype.slice.call(arguments,1));return this.transpiler.updateTemplateLiteralParser(),this.transpiler.parseCode(t,this.parser)},Mode.prototype.parseCodeToSource=function(e){var t=Parser.prototype[e].apply(this.parser,Array.prototype.slice.call(arguments,1));return this.transpiler.parseCode(t,this.parser).source},Mode.prototype.parseCodeToValue=function(){return this.parseCode.apply(this,arguments).toValue()},Mode.prototype.start=function(){},Mode.prototype.end=function(){},Mode.prototype.chainAfter=function(){},Mode.prototype.parse=function(){},BreakpointMode.prototype=Object.create(Mode.prototype),BreakpointMode.prototype.next=function(){},BreakpointMode.prototype.parse=function(e,t){var r=this.parser.find(this.breakpoints,!1,!0);r.pre&&this.add(r.pre),"<"==r.match?this.parser.couldStartRegExp()&&"<"!=this.parser.input.charAt(this.parser.index-2)?e():(this.add("<"),this.parser.last="<",this.parser.lastIndex=this.parser.index):r.match?this.next(r.match):t()},TextExprMode.prototype=Object.create(Mode.prototype),TextExprMode.prototype.addText=function(e){this.chain.push(["text",e])},TextExprMode.prototype.addSpace=function(e){this.chain.push([,e])},TextExprMode.prototype.addCurrent=function(){var e=this,t=void 0;if(this.attributes.trimmed&&1==this.current.length&&(t=this.current[0]).text&&/^\s*$/.test(t.value))this.addSpace(t.value);else{var o=this.current.filter(function(e){return!e.text||e.value.length});if(o.length){var r=this.es6?"`"+o.map(function(t){var r=t.text,a=t.value;return r?e.replaceText(a).replace(/(`|\$|\\)/gm,"\\$1"):"${"+a.source+"}"}).join("")+"`":"\"\" + "+o.map(function(t){var r=t.text,a=t.value;return r?stringify(e.replaceText(a)):"("+a.source+")"}).join(" + "),a=[],s=[];o.forEach(function(e){var t=e.text,r=e.value;t||(a.push.apply(a,_toConsumableArray(r.observables)),s.push.apply(s,_toConsumableArray(r.maybeObservables)))}),(a.length||s.length)&&(r=this.transpiler.feature("bo")+"("+(this.es6?"() => "+r:"function(){return "+r+"}.bind(this)")+", ["+uniq(a).join(", ")+"]"+(s.length?", ["+uniq(s).join(", ")+"]":"")+")"),this.addText(r)}}this.current=[]},TextExprMode.prototype.endChain=function(){var e=this;this.addCurrent();var t="",r=!0;this.chain.forEach(function(a){var s=a.shift();s?(r=!1,t+=", ["+e.transpiler.chainFeature(s)+", "+a.join("")+"]"):t+=a[0]}),r?this.source.addSource(t):this.source.addSource(this.transpiler.chain+"("+this.source.getContext()+t+");"),this.chain=[]},TextExprMode.prototype.endChainable=function(){this.endChain(),this.chainable=!1},TextExprMode.prototype.addFinalCurrent=function(){this.endChain()},TextExprMode.prototype.pushText=function(e){var t=this.current[this.current.length-1];t&&t.text?t.value+=e:this.current.push({text:!0,value:e})},TextExprMode.prototype.pushExpr=function(e){this.current.push({text:!1,value:e})},TextExprMode.prototype.trimEnd=function(){var e="",t=this.current[this.current.length-1];if(t&&t.text){var r=Polyfill.trimEnd.call(t.value);e=t.value.substr(r.length),t.value=r}return e},TextExprMode.prototype.replaceText=function(e){return e},TextExprMode.prototype.handle=function(){return!0},TextExprMode.prototype.parseImpl=function(e,t,r,a){switch(t){case"$":case"#":if("\\"==e.slice(-1)){var o=this.current[this.current.length-1];o.value=o.value.slice(0,-1)+t;break}else if("{"==this.parser.peek()){var s=this.parseCode("skipEnclosedContent",!0);"#"==t?(this.addCurrent(),this.chain.push(["mixin",s.source])):this.pushExpr(s)}else this.pushText(t);break;case"<":this.handle()?("/"==this.parser.peek()?this.endChain():this.endChainable(),r()):this.pushText("<");break;default:this.endChain(),a();}},TextExprMode.prototype.parse=function(e,t){var r=this.parser.find(["<","$","#"],!1,!0);this.pushText(r.pre),this.parseImpl(r.pre,r.match,e,t)},LogicMode.prototype=Object.create(TextExprMode.prototype),LogicMode.prototype.getLineText=function(){var e=this.current[this.current.length-1];if(e&&e.text){var t=e.value.lastIndexOf("\n");if(-1!=t)return e.value.substr(t)}return!1},LogicMode.prototype.parseIf=function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=void 0;if(this.parser.input.substr(this.parser.index,e.length-1)==e.substr(1)&&(!t||(r=this.getLineText())&&!/\S/.test(r))&&!/[a-zA-Z0-9_$]/.test(this.parser.input.charAt(this.parser.index+e.length-1)))return!0;if(r&&"\\"==r.slice(-1)){var a=this.current[this.current.length-1];a.value=a.value.slice(0,-1)}return!1},LogicMode.prototype.parseStatement=function(e,t,r,a,s){var o=this,n=this.parser.index;this.parser.index+=r.length-1;var p={type:r,following:s,observables:[],maybeObservables:[],declStart:this.source.addIsolatedSource("")};if(e.parts.push(p),1===a){var l=this.parser.skipImpl({comments:!0});if("("!=this.parser.peek())return this.parser.index=n,this.pushText(t),!1;this.endChainable(),this.add(t);var i=function(t,r){var a,s,n,i,d=o.transpiler.parseCode(t,r);return(a=e.observables).push.apply(a,_toConsumableArray(d.observables)),(s=e.maybeObservables).push.apply(s,_toConsumableArray(d.maybeObservables)),(n=p.observables).push.apply(n,_toConsumableArray(d.observables)),(i=p.maybeObservables).push.apply(i,_toConsumableArray(d.maybeObservables)),d.source},d=this.parser.position,u=i(this.parser.skipEnclosedContent(),this.parser);if("foreach"==r){var c=new Parser(u.slice(1,-1),d);Polyfill.assign(c.options,{comments:!0,strings:!0,regexp:!0}),l+=c.skipImpl({comments:!0});var m,h,f;Polyfill.startsWith.call(c.input.substr(c.index),"from ")?(c.index+=5,h=i(c.readExpression()),c.expectSequence("to "),f=i(c.readExpression())):Polyfill.startsWith.call(c.input.substr(c.index),"to ")?(c.index+=3,h="0",f=i(c.readExpression())):m=c.readExpression();var b="";if("as "==c.input.substr(c.index,3)&&(c.index+=3,b=c.input.substr(c.index)),m){var y,x=b.indexOf(":");-1==x||-1!=(y=b.substring(0,x)).indexOf("{")||-1!=y.indexOf("[")?(e.ref.a=this.source.addIsolatedSource(this.transpiler.feature("forEachArray")+"("),e.ref.b=this.source.addIsolatedSource(m),this.es6?(e.ref.c=this.source.addIsolatedSource(", ("),this.source.addIsolatedSource(b+") =>")):(e.ref.c=this.source.addIsolatedSource(", function("),this.source.addIsolatedSource(b+")"))):(e.type=p.type="object-foreach",b=y+","+b.substr(x+1),this.source.addSource(this.transpiler.feature("forEachObject")+"("+m+", "+(this.es6?"("+b+") =>":"function("+b+")")))}else e.type=p.type="range",this.source.addSource(this.transpiler.feature("range")+"("+h+", "+f+", "+(this.es6?"("+b+") =>":"function("+b+")"));this.es6||(e.end+=".bind(this)"),e.end+=");",e.inlineable=!1}else p.decl=this.source.addIsolatedSource(r+l+u)}else this.endChainable(),this.add(t),p.decl=this.source.addIsolatedSource(r);return this.source.addSource(this.parser.skipImpl({comments:!0})),(e.inline=p.inline=!this.parser.readIf("{"))&&e.inlineable||this.source.addSource("{"),p.declEnd=this.source.addIsolatedSource(""),this.statements.push(e),this.onStatementStart(e),!0},LogicMode.prototype.parseLogic=function(e,t,r){if(this.parseIf(e)){var a=this.trimEnd();if(0===t){this.endChainable();var s=this.parser.find(r||["=",";"],!0,{comments:!0});return this.add(a+e.charAt(0)+s.pre+s.match),"="==s.match&&(this.add(this.transpiler.parseCode(this.parser.readExpression()).source),this.parser.readIf(";")&&this.add(";")),!0}return this.parseStatement({type:e,startRef:this.source.addIsolatedSource(""),context:this.source.getContext(),observables:[],maybeObservables:[],inlineable:!0,end:"",parts:[],ref:{}},a,e,t,r)}return!1},LogicMode.prototype.find=function(){return this.parser.find(["$","#","<","c","l","v","b","d","i","f","w","s","}","\n"],!1,!1)},LogicMode.prototype.parse=function(e,t){var r=this.find();switch(r.pre.length&&this.pushText(r.pre),r.match){case"c":this.parseLogic("const",0)||this.parseLogic("case",0,[":"])||this.pushText("c");break;case"l":this.parseLogic("let",0)||this.pushText("l");break;case"v":this.parseLogic("var",0)||this.pushText("v");break;case"b":this.parseLogic("break",0)||this.pushText("b");break;case"d":this.parseLogic("default",0,[":"])||this.pushText("d");break;case"i":this.parseLogic("if",1,[["else if",1,!0],["else",2,!1]])||this.pushText("i");break;case"f":this.parseLogic("foreach",1)||this.parseLogic("for",1)||this.pushText("f");break;case"w":this.parseLogic("while",1)||this.pushText("w");break;case"s":this.parseLogic("switch",1)||this.pushText("s");break;case"}":if("\\"==r.pre.slice(-1)){var a=this.current[this.current.length-1];a.value=a.value.slice(0,-1)+"}"}else this.statements.length?this.closeStatement(!1):this.pushText("}");break;case"\n":this.statements.length&&this.statements[this.statements.length-1].inline?this.closeStatement(!0):this.pushText("\n");break;default:this.parseImpl(r.pre,r.match,e,t);}},LogicMode.prototype.closeStatement=function(e){var t=this.statements.pop(),r=t.parts[t.parts.length-1],a=this.trimEnd();if(this.endChainable(),this.source.addSource(a),e&&!t.inlineable&&this.source.addSource("}"),t.endRef=r.close=this.source.addIsolatedSource((e?"":"}")+t.end),this.onStatementEnd(t),e&&this.pushText("\n"),r.following){for(var s=this.parser.skipImpl({comments:!0}),o=0;o<r.following.length;o++){var n=_slicedToArray(r.following[o],3),p=n[0],d=n[1],u=n[2];if(u&&(u=r.following),this.parser.readIf(p.charAt(0)))if(!this.parseIf(p,!1))this.parser.index--;else if(this.parseStatement(t,s,p,d,u))return}this.pushText(s)}this.popped.push(t)},LogicMode.prototype.onStatementStart=function(){},LogicMode.prototype.onStatementEnd=function(){},LogicMode.prototype.end=function(){var e=this;this.popped.forEach(function(t){if(t.observables.length||t.maybeObservables.length)if("if"==t.type){var r=[],a=e.es6?", "+t.context+" =>":", function("+t.context+")";t.parts.forEach(function(t){var s=t.decl.value.substr(t.type.length);if("else"==t.type)r.push("[]");else{var o=e.es6?"() => "+s:"function(){return "+s+"}.bind(this)";r.push("["+o+", ["+uniq(t.observables)+"]"+(t.maybeObservables.length?", ["+uniq(t.maybeObservables)+"]":"")+"]")}t.declStart.value=a,t.inline&&(t.declStart.value+="{",t.close.value+="}"),t.decl.value=""}),t.startRef.value=e.transpiler.feature("bindIfElse")+"("+t.context+", ["+r.join(", ")+"]"+t.startRef.value,t.endRef.value+=(e.es6?"":".bind(this)")+");"}else if("foreach"==t.type){var s=t.ref.b.value,o=e.es6?"() => "+s:"function(){return "+s+"}.bind(this)",n=!!t.maybeObservables.length;t.ref.a.value="",t.ref.b.value="",t.ref.c.value=e.transpiler.feature("bindEach"+(n?"Maybe":""))+"("+t.context+", "+(n?t.maybeObservables:t.observables)[0]+", "+o+", "+(e.es6?"":"function")+"("+t.context+", "}else{var p=e.transpiler.feature("bind")+"("+t.context+", ["+uniq(t.observables).join(", ")+"], ["+t.maybeObservables.join(", ")+"], ",i="}";e.es6?p+=t.context+" => ":(p+="function("+t.context+")",i+=".bind(this)"),t.startRef.value=p+"{"+t.startRef.value,t.endRef.value+=i+");"}})},OptionalLogicMode.prototype=Object.create(LogicMode.prototype),SourceCodeMode.getOptions=function(){return{isDefault:!0,code:!0,comments:!0,strings:!0,regexp:!0}},SourceCodeMode.prototype=Object.create(BreakpointMode.prototype),SourceCodeMode.prototype.restoreIndex=function(e){this.add(this.parser.last=e),this.parser.lastIndex=this.parser.index-1},SourceCodeMode.prototype.handleParenthesis=function(e){this.restoreIndex(e)},SourceCodeMode.prototype.addObservable=function(e,t,r,a){if(r.length){var o=this.source.tail();o.value=o.value.slice(0,-r.length)}var s=!!this.parser.readIf("?");r+="("==this.parser.peek()?this.parseCodeToSource("skipEnclosedContent"):this.parseCodeToSource("readVarName",!0),a?this.source.addSource(this.transpiler.value+"."+(s?"m":"d")+"("+r+")"):s?(this.source.addSource(this.transpiler.feature("value")+"("+r+")"),t&&t.push(r)):(this.add(r+".value"),e&&e.push(r)),this.parser.last="]",this.parser.lastIndex=this.parser.index-1},SourceCodeMode.prototype.lookBehind=function(){for(var e=this.parser.lastIndex,t=e;0<=t&&/[\sa-zA-Z0-9_$.]/.test(this.parser.input.charAt(t));)t--;return this.parser.input.substring(t+1,e+1)},SourceCodeMode.prototype.next=function(e){switch(e){case"(":this.parser.parentheses.push({lastIndex:this.parser.lastIndex,start:this.parser.index}),this.handleParenthesis(e);break;case")":var t=this.parser.parentheses.pop();t&&(t.end=this.parser.index),this.parser.lastParenthesis=t,this.handleParenthesis(e);break;case"{":var r=this.parser.last;if(this.restoreIndex("{"),!this.attributes.inAttr&&")"==r&&!this.parser.lastKeywordAtIn(this.parser.lastParenthesis.lastIndex,"if","for","while","switch","catch","with")){var m=this.parser.lastParenthesis;this.source.startFunction(this.parser.input.substring(m.start,m.end-1))}else this.source.startScope();break;case"}":this.restoreIndex("}"),this.source.endScope();break;case"$":{if(this.parser.readIf("$")){var h=this.parser.input.substr(this.parser.index);if(Polyfill.startsWith.call(h,"context"))return this.parser.index+=7,this.source.addContext(),void(this.parser.last="t");var f=["on","subscribe","depend","rollback","bind","unbind","bindInput"];for(var b in f){var i=f[b];if(Polyfill.startsWith.call(h,i+"("))return this.parser.index+=i.length+1,this.source.addSource("$$"+i+"("),this.source.addContext(),this.source.addSource(", "),void(this.parser.last=",")}this.restoreIndex("$")}this.restoreIndex("$");break}case"&":{if(this.parser.couldStartRegExp()||this.parser.lastKeywordIn("async")){var a=this.parser.skipImpl({comments:!0}),s=!0,o=this.source.tail(),n=void 0,p=function(){for(var e=o.value.length,t=n;n<e&&/\s/.test(o.value.charAt(e-n-1));)n++;for(var r=n;n<e&&/[a-zA-Z0-9_$]/.test(o.value.charAt(e-n-1));)n++;return r==n?(n=t,!1):o.value.substr(o.value.length-n,n-r)};if(this.parser.parseTemplateLiteral=null,this.parser.readIf(")")){this.add(a);var y=this.parser.parentheses.pop();if(y&&(y.end=this.parser.index),this.parser.lastParenthesis=y,this.handleParenthesis(")"),y){var x=y.start;if(this.add(this.parser.skipImpl({comments:!0})),this.parser.readIf("="))this.parser.expect(">"),this.add("=>"),n=this.parser.index-x;else if("{"==this.parser.peek())this.parser.lastKeywordAt(y.lastIndex,"function")?n=this.parser.index-y.lastIndex+6:(n=this.parser.index-y.lastIndex-2,p(),p());else{var g=o.value.length-(this.parser.index-this.parser.lastParenthesis.end)-1;o.value=""+o.value.substring(0,g)+this.transpiler.feature("cofv")+"()"+o.value.substr(g),s=!1}}}else if("="==this.parser.peek())n=a.length+4,this.parser.read(),this.parser.expect(">"),this.source.addSource("()"+a+"=>");else{var v=this.transpiler.parseCode(this.parser.readSingleExpression(!0));this.add(""+a+this.transpiler.feature("cofv")+"("+v.source+")"),s=!1}if(s){for(var d=n,u=n,l=void 0,c={};(l=p())&&-1!=["async"].indexOf(l);)c[l]=!0,d=n;var S=this.transpiler.parseCode(this.parser.readExpression());if(S.wrapped){var I=this.es6?this.transpiler.value+" => ":"function("+this.transpiler.value+"){return ";o.value=""+o.value.slice(0,-d)+this.transpiler.feature("cofr")+"("+I+o.value.substr(-u)}else o.value=""+o.value.slice(0,-d)+this.transpiler.feature("coff")+"("+o.value.substr(-u);this.source.addSource(""+S.source+(S.wrapped&&!this.es6?"}.bind(this)":"")+")"),c.async&&this.source.addSource(".async()"),S.observables.length&&this.source.addSource(".d("+this.source.getContext()+", "+uniq(S.observables).join(", ")+")"),S.maybeObservables.length&&this.source.addSource(".m("+this.source.getContext()+", "+uniq(S.maybeObservables).join(", ")+")")}this.transpiler.updateTemplateLiteralParser(),this.parser.last="]",this.parser.lastIndex=this.parser.index-1}else this.restoreIndex("&"),this.parser.readIf("&")&&this.restoreIndex("&");break}case"*":this.parser.couldStartRegExp()?this.parser.readIf("*")?this.addObservable(null,null,"",this.wrapped=!0):this.addObservable(this.observables,this.maybeObservables,"",!1):"."==this.parser.last?this.parser.readIf("*")?this.addObservable(null,null,this.lookBehind(),this.wrapped=!0):this.addObservable(this.observables,this.maybeObservables,this.lookBehind(),!1):(this.restoreIndex("*"),this.parser.readIf("*")&&this.restoreIndex("*"));break;case"^":this.parser.couldStartRegExp()?this.addObservable(null,null,""):"."==this.parser.last?this.addObservable(null,null,this.lookBehind()):this.restoreIndex("^");}},AutoSourceCodeMode.getOptions=SourceCodeMode.getOptions,AutoSourceCodeMode.prototype=Object.create(SourceCodeMode.prototype),HTMLMode.getOptions=function(){return{}},HTMLMode.prototype=Object.create(OptionalLogicMode.prototype),HTMLMode.prototype.replaceText=Text.replaceEntities||function(){var e;return function(t){return e||(e=document.createElement("textarea")),e.innerHTML=t,e.value}}(),AutoHTMLMode.getOptions=HTMLMode.getOptions,AutoHTMLMode.matchesTag=function(e,t){return t instanceof AutoSourceCodeMode&&":debug"!=e&&":bind"!=e},AutoHTMLMode.prototype=Object.create(HTMLMode.prototype),ScriptMode.getOptions=function(){return{children:!1}},ScriptMode.matchesTag=function(e){return"script"==e.toLowerCase()},ScriptMode.prototype=Object.create(TextExprMode.prototype),ScriptMode.prototype.usedAttributes=function(){return this.scope?[{type:"~",name:"class",value:"\"script"+this.scope+"\""}]:[]},ScriptMode.prototype.endChain=function(){this.scope&&this.pushText("}.call(document.querySelector(\".script"+this.scope+"\").parentNode)"),TextExprMode.prototype.endChain.call(this)},ScriptMode.prototype.addCurrent=function(){this.current.forEach(function(e){var t=e.text,r=e.value;t||(r.observables=r.maybeObservables=[])}),TextExprMode.prototype.addCurrent.call(this)},ScriptMode.prototype.handle=function(){return!!/^\/script>/.exec(this.parser.input.substr(this.parser.index))},ScriptMode.prototype.parseImpl=function(e,t){if("#"!=t)TextExprMode.prototype.parseImpl.apply(this,arguments);else if("\\"==e.slice(-1)){var a=this.current[this.current.length-1];a.value=a.value.slice(0,-1)+t}else if("{"==this.parser.peek()){var r=this.parseCode("skipEnclosedContent",!0);r.source=this.transpiler.feature("stringify")+"("+r.source+")",this.pushExpr(r)}else this.pushText(t)},ScriptMode.prototype.parse=function(e,t){var r=this.parser.find(["<","#"],!1,!0);this.pushText(r.pre),this.parseImpl(r.pre,r.match,e,t)},CSSMode.getOptions=function(){return{comments:!0,inlineComments:!1,strings:!0,children:!1}},CSSMode.prototype=Object.create(OptionalLogicMode.prototype),SSBMode.getOptions=function(){return{children:!1}},SSBMode.matchesTag=function(e){return"style"==e.toLowerCase()},SSBMode.prototype=Object.create(LogicMode.prototype),SSBMode.prototype.addScope=function(e){var t=this.transpiler.nextVarName();this.add((this.es6?"const":"var")+" "+t+"="+this.scopes[this.scopes.length-1]+".select("+e+");"),this.scopes.push(t)},SSBMode.prototype.removeScope=function(){this.scopes.pop()},SSBMode.prototype.skip=function(){var e=this.parser.skip();e&&this.add(e)},SSBMode.prototype.start=function(){var e=[this.transpiler.value];!1!=this.attributes.dollar&&e.push("$"),this.source.addSource(this.transpiler.feature("cabs")+"("+this.source.getContext()+", "+(this.scope||+this.scoped)),this.source.addSource(", "+(this.es6?"("+e.join(", ")+") => ":"function("+e.join(", ")+")")+"{")},SSBMode.prototype.find=function(){return this.parser.find(["$","<","v","c","l","i","f","{","}","/","\"","'",";"],!1,!1)},SSBMode.prototype.lastValue=function(e,t){for(var r,a=this,s="";this.current.length;)if(r=this.current[0],r.comment)this.add(r.value),this.current.shift();else if(r.text){var n=Polyfill.trimStart.call(r.value);if(this.add(r.value.substring(0,r.value.length-n.length)),0==n.length)this.current.shift();else{r.value=n;break}}else break;for(;this.current.length;){var p=this.current[this.current.length-1];if(p.comment)s=p.value+s,this.current.pop();else if(p.text){var i=Polyfill.trimEnd.call(p.value);if(s=p.value.substr(i.length)+s,0==i.length)this.current.pop();else{p.value=i;break}}else break}var o=this.current.filter(function(e){if(e.text||e.comment)return e.value.length;var t,r;return(t=a.observables).push.apply(t,_toConsumableArray(e.value.observables)),(r=a.maybeObservables).push.apply(r,_toConsumableArray(e.value.maybeObservables)),!0});o.length||o.push({text:!0,value:""}),this.es6?e("`"+o.map(function(e){return e.text?e.value.replace(/(`|\$|\\)/gm,"\\$1"):e.comment?"${\"\""+e.value+"}":"${"+(t?t(e.value.source):e.value.source)+"}"}).join("")+"`"):(!o[0].text&&o.unshift({text:!0,value:""}),e(o.map(function(e){return e.text?stringify(e.value):e.comment?e.value:t?t(e.value.source):"("+e.value.source+")"}).join(" + "))),s&&this.add(s),this.current=[]},SSBMode.prototype.parseImpl=function(e,t,r,a){var s=this;switch(t){case"<":if(!/\s/.test(this.parser.peek())){TextExprMode.prototype.parseImpl.call(this,e,t,r,a);break}case"{":this.lastValue(function(e){return s.addScope(e)}),this.statements.push({selector:!0,observables:[],maybeObservables:[],end:"",parts:[{}],single:"<"==t}),this.inExpr=!1;break;case"/":if(this.parser.readIf("/")){var n=this.current[this.current.length-1];!n||n.comment||n.text&&/(^|\n)[ \t]*$/.test(n.value)?this.current.push({comment:!0,value:"//"+this.parser.findSequence("\n",!1)}):this.pushText("//")}else this.parser.readIf("*")?this.current.push({comment:!0,value:"/*"+this.parser.findSequence("*/",!0)}):this.pushText("/");break;case"\"":case"'":this.parser.index--,this.pushText(this.parser.skipString());break;case";":{var o=function(){var e=s.scopes[s.scopes.length-1],t=s.current.filter(function(e){return!e.comment&&(!e.text||e.value.trim().length)});if(1==t.length&&!t[0].text&&Polyfill.startsWith.call(t[0].value.source,"...")){s.add(e+".spread("+t[0].value.source.substr(3)+");");for(var d;(d=s.current.pop()).text||d.comment;)s.add(d.value);s.current=[]}else{for(var r,a=void 0,o=!0,n=0;n<s.current.length;n++){if(r=s.current[n],r.text){if(!o&&"@"==r.value.charAt(0))break;var u=r.value.indexOf(":");if(-1!=u){a=s.current.slice(n+1),a.unshift({text:!0,value:r.value.substr(u+1)}),r.value=r.value.substring(0,u),s.current=s.current.slice(0,n+1),s.lastValue(function(t){return s.add(e+".value("+t)}),s.add(","),s.current=a,s.lastValue(function(e){return s.add(e+");")},function(e){return SSBMode.reparseExpr(e,s.transpiler)});break}}r.comment||(o=!1)}a||s.lastValue(function(t){return s.add(e+".stat("+t+");")})}var p=s.statements[s.statements.length-1];return p&&p.single&&s.onStatementEnd(s.statements.pop()),s.inExpr=!1,"break"}();if("break"===o)break}default:TextExprMode.prototype.parseImpl.call(this,e,t,r,a);}},SSBMode.prototype.parse=function(e,t){this.inExpr||(this.pushText(this.parser.skip()),this.inExpr=!0),LogicMode.prototype.parse.call(this,e,t)},SSBMode.prototype.onStatementStart=function(){this.inExpr=!1},SSBMode.prototype.onStatementEnd=function(e){if(e.selector)this.removeScope(),e.endRef&&(e.endRef.value="");else{var t,r;(t=this.observables).push.apply(t,_toConsumableArray(e.observables)),(r=this.maybeObservables).push.apply(r,_toConsumableArray(e.maybeObservables))}this.inExpr=!1},SSBMode.prototype.addFinalCurrent=function(){for(;this.current.length;)this.add(this.current.shift().value)},SSBMode.prototype.addCurrent=function(){var e=this;this.current.forEach(function(t){t.comment?e.add(t.value):t.text?(!/^\s*$/.test(t.value)&&e.parser.error("Statement `"+t.value+"` not closed."),e.add(t.value)):e.parser.error("Statement `${"+t.value.source+"}` not closed.")}),this.current=[]},SSBMode.prototype.end=function(){var e=this;this.popped.forEach(function(t){t.selector?e.source[t.endIndex-1]="":t.end.length&&(e.source[t.endIndex]=t.end+e.source[t.endIndex])}),this.add("}"+(this.es6?"":".bind(this)")+", ["+uniq(this.observables).join(", ")+"], ["+this.maybeObservables.join(", ")+"])")},SSBMode.prototype.chainAfter=function(){if(this.scoped)return[this.transpiler.feature("scope")]},SSBMode.reparseExprImpl=function(e,t,r){function a(){var e=n.skipImpl({comments:!0,strings:!1});e&&(t.computed+=e)}function s(){var e=n.readImpl(/^[+-]{1,2}/,!1);e&&(t.computed+=e,t.op++)}function o(){var e=n.readImpl(/^[+*/%-]/,!1);if(e)return t.computed+=e,t.op++,!0}var n=new Parser(e);for(Polyfill.assign(n.options,{comments:!0,strings:!0});!n.eof();){if(a(),s(),"("==n.peek()){if(t.computed+="(",!SSBMode.reparseExprImpl(n.skipEnclosedContent().slice(1,-1),t,r))return!1;t.computed+=")"}else{var p=n.readSingleExpression(!0);/^[a-zA-Z_$]/.exec(p)?(t.is=!0,t.computed+=r.value+"("+p+")"):t.computed+=p}s(),a();var i=o();if(a(),!i&&!n.eof())return!1}return!0},SSBMode.reparseExpr=function(e,t){var r={runtime:t.runtime,computed:t.feature("cu")+"("+(t.options.es6?t.value+" =>":"function("+t.value+"){return")+" ",is:!1,op:0};return SSBMode.reparseExprImpl(e,r,t)&&r.is&&r.op&&""+r.computed+(t.options.es6?"":"}.bind(this)")+")"||(t.options.es6?e:"("+e+")")},HTMLCommentMode.getOptions=function(){return{children:!1}},HTMLCommentMode.prototype=Object.create(TextExprMode.prototype),HTMLCommentMode.prototype.add=function(e){e.length&&this.values.push(stringify(e))},HTMLCommentMode.prototype.addText=function(e){this.values.push(e)},HTMLCommentMode.prototype.parse=function(e,t){var r=this.parser.find(["$"],!1,!0);this.pushText(r.pre),this.parseImpl(r.pre,r.match,e,t)},defineMode(["code","javascript","js"],SourceCodeMode,!0),defineMode(["html"],HTMLMode),defineMode(["script"],ScriptMode),defineMode(["css"],CSSMode),defineMode(["ssb","style"],SSBMode),defineMode(["__comment"],HTMLCommentMode),defineMode(["auto-code"],AutoSourceCodeMode),defineMode(["auto-html"],AutoHTMLMode),Transpiler.transpile=function(e,t){var r=new Transpiler(e).transpile(t);return r.toString=function(){return r.source.all},r},Transpiler.prototype.nextId=function(){return this.count++},Transpiler.prototype.nextVar=function(){return String.fromCharCode(1377+this.count++%39)},Transpiler.prototype.nextVarName=function(){for(var e,r=this.count++%1521,a="",o=0;2>o;o++)e=r%39,a=String.fromCharCode(1377+e)+a,r=Math.floor((r-e)/39);return a},Transpiler.prototype.nextLatinVarName=function(){for(var e,r=this.count++%1296,a="",o=0;2>o;o++)e=r%36,a=(10>e?e:String.fromCharCode(97+e-10))+a,r=Math.floor((r-e)/36);return"$_"+a},Transpiler.prototype.warn=function(e,t){t||(t=this.parser.position),this.warnings.push({message:e,position:t})},Transpiler.prototype.startMode=function(e,t){var r=startMode(e,this,this.parser,this.source,t,this.currentMode&&this.currentMode.parser);return this.currentMode={name:modeRegistry[e].name,parser:r,options:r.options},this.modes.push(this.currentMode),r},Transpiler.prototype.endMode=function(){var e=this.modes.pop().parser;return e.end(),this.currentMode=this.modes[this.modes.length-1],this.currentMode&&Polyfill.assign(this.parser.options,this.currentMode.options),e},Transpiler.prototype.parseImpl=function(e,t,r){var a=this,s=new Parser(t,(r||this.parser).position),o=this.source.fork(),n=startMode(e,this,s,o,{inAttr:!0});for(n.observables&&(s.parseTemplateLiteral=function(e){var t,r,o=a.parseCode(e,s);return(t=n.observables).push.apply(t,_toConsumableArray(o.observables)),(r=n.maybeObservables).push.apply(r,_toConsumableArray(o.maybeObservables)),o.source}),n.start();s.index<t.length;)n.parse(function(){return o.addSource("<")},function(){});return n.end(),{mode:n,source:o}},Transpiler.prototype.parseCode=function(e,t){var r=this,a=this.parseImpl(defaultMode,e,t),s=a.mode,o=a.source;o=o.toString();var n=s.observables?uniq(s.observables):[],p=s.maybeObservables?uniq(s.maybeObservables):[],i={source:o,observables:n,maybeObservables:p,wrapped:!!s.wrapped,toAttrValue:function e(){return n.length||p.length?r.feature("bo")+"("+i.toSpreadValue()+", ["+n.join(", ")+"]"+(p.length?", ["+p.join(", ")+"]":"")+")":o},toSpreadValue:function e(){return r.options.es6?"() => "+o:"function(){return "+o+"}.bind(this)"}};return i},Transpiler.prototype.parseText=function(e,t){return this.parseImpl(modeNames.__comment,e,t).mode.values.join(" + ")},Transpiler.prototype.parseTemplateLiteral=function(e,t){return this.parseCode(e,t).source},Transpiler.prototype.updateTemplateLiteralParser=function(){this.parser.parseTemplateLiteral=this.parseTemplateLiteral.bind(this)},Transpiler.prototype.addSemicolon=function(){if(this.currentMode.options.code){var e=this.parser.skip(),t=this.parser.peek();/[;:,.)\]}&|=]/.test(t)||this.source.push(";"),e&&this.source.push(e)}else this.source.push(";")},Transpiler.prototype.close=function(e){if(void 0!==e){var t=this.tags.pop();if(t.tagName&&t.tagName!=e&&this.parser.errorAt(t.position,"Tag '"+t.tagName+"' is not closed properly (used '</"+e+">' instead of '</"+t.tagName+">')."),t.mode){var r=this.endMode();r.chainable&&t.hasBody}this.inherit.pop(),this.level--}this.closing.length&&(this.source.push(this.closing.pop()),this.addSemicolon())},Transpiler.prototype.open=function(){var e=this;if("/"==this.parser.peek()){this.parser.index++;var t=this.parser.find([">"],!0,!1);this.close(t.pre)}else if("!"==this.parser.peek()){this.parser.index++;var r=this.parser.input.substr(this.parser.index);if(Polyfill.startsWith.call(r,"COMMENT "))this.warn("The '<!COMMENT ...>' tag is deprecated. Use '<!// ...' or '<!/* ... */>' instead."),this.parser.index+=8,this.source.push("/*"+this.parser.findSequence(">",!0).slice(0,-1)+"*/");else{var K=this.parser.input.substr(this.parser.index,2);"--"==K?(this.parser.index+=2,this.source.addSource(this.feature("comment")+"("),this.source.addContext(),this.source.addSource(", "+this.parseText(this.parser.findSequence("-->",!0).slice(0,-3))+")"),this.addSemicolon()):"/*"==K?this.source.push(this.parser.findSequence("*/>",!0).slice(0,-1)):"//"==K?this.source.push(this.parser.findSequence("\n",!1)):this.source.push("<")}}else if(!1===this.currentMode.options.children&&"#"!=this.parser.peek())throw new Error("Mode '"+this.currentMode.name+"' cannot have children.");else{var s,o,n,p,d,u,l,m=this.parser.position,h=this.parser,f="",b=function(){return f=h.skipImpl({comments:!0})},y=!0,x=!0,g=!0,v=!1,S=!1,I={},E=[],C=[],A=void 0,O=null,T=[],w=[],k=!1,N="",P=!!this.parser.readIf("?");this.updateTemplateLiteralParser(),(N=this.parser.readComputedExpr())?(N=u=this.parseCode(N).source,k=!0):(d=N=this.parser.readTagName(!0),this.options.capitalIsWidget&&65<=N.charCodeAt(0)&&90>=N.charCodeAt(0)&&(k=!0,u=N)),b(),"("==this.parser.peek()&&(p=this.parser.skipEnclosedContent(!0),b());for(var j=!1;!this.parser.eof()&&">"!=(j=this.parser.peek())&&"/"!=j;){/[\n\t ]/.test(f)||this.parser.error("Space is required between attribute names."),this.updateTemplateLiteralParser();var V={optional:!!this.parser.readIf("?"),negated:!!this.parser.readIf("!"),type:this.parser.readAttributePrefix()||"",beforeName:f};if(this.isSpreadAttribute())C.push({type:Attr.SPREAD,attr:{type:V.type,expr:this.parser.readSingleExpression(!1,!0),space:f}}),b();else{var L=this.parseAttributeName(!1);if(this.parser.readIf("{")){(":"==V.type||"*"==V.type)&&this.parser.error("Cannot interpolate this type of attribute."),V.before=L,V.inner=[];do{var $,M=b();this.isSpreadAttribute()?V.inner.push($={spread:!0,expr:this.parser.readSingleExpression(!1,!0)}):($=this.parseAttributeName(!0),this.compileAttributeParts($),V.inner.push($)),$.beforeValue=M,$.afterValue=b()}while(","==(j=this.parser.read()));"}"!=j&&this.parser.error("Expected `}` after interpolated attributes list."),V.after=this.parseAttributeName(!1),this.compileAttributeParts(V.before),this.compileAttributeParts(V.after)}else 0==L.parts.length&&"$"!=V.type?this.parser.error("Cannot find a valid attribute name."):Polyfill.assign(V,L);if(b(),"="==this.parser.peek()){V.afterName=f,this.parser.index++,V.beforeValue=b(),this.parser.parseTemplateLiteral=null;var R=this.parser.readAttributeValue(),q=this.parseCode(R);if("{{"==q.source.substr(0,2)&&"}}"==q.source.slice(-2)){var U=q.source.slice(1,-1);V.value=this.options.es6?"(event, target) => "+U:"function(event, target)"+U+".bind(this)"}else if("+"==V.type){var B=q.source;"{"==B.charAt(0)&&"}"==B.charAt(B.length-1)?(this.warn("The `{ ... }` syntax for functions as attribute values is deprecated. Use the `{{ ... }}` syntax instead."),V.value=this.options.es6?"(event, target) => "+B:"function(event, target)"+B+".bind(this)"):V.value=B}else V.value=q.toAttrValue();V.sourceValue=q.source,b()}if(V.inner)Object.prototype.hasOwnProperty.call(V,"value")||(V.value=this.getDefaultAttributeValue(V)),C.push({type:Attr.INTERPOLATED,attr:V});else switch(this.compileAttributeParts(V),V.type){case":":if(V.computed&&this.parser.error("Compile-time attributes cannot be computed."),Object.prototype.hasOwnProperty.call(V,"value")||(V.value=!V.negated),!Object.prototype.hasOwnProperty.call(I,V.name))I[V.name]=V.value;else if(I[V.name]instanceof Array)I[V.name].push(V.value);else{var D=I[V.name]=[I[V.name],V.value];D.toString=function(){return"["+D.join(", ")+"]"}}E.push(V.beforeName+"/*"+V.name+(V.afterName||"")+"="+(V.beforeValue||"")+V.value+"*/");break;case"*":{var G=V.parts[0];(!G||G.computed)&&this.parser.error("First part of bind attributes cannot be computed.");var X=G.name.indexOf(":");-1==X&&(X=G.name.length);var Y=G.name.substring(0,X);"next"===Y||"prev"===Y?this.warn("Attributes `*next` and `*prev` are deprecated. Use `~next` and `~prev` instead."):"show"===Y||"hide"===Y?this.warn("Attributes `*show` and `*hide` are deprecated. Use `~show` and `~hide` instead."):(Object.prototype.hasOwnProperty.call(V,"value")||this.parser.error("Value for form attribute is required."),X==G.name.length||X==G.name.length-1?V.parts.shift():G.name=G.name.substr(X+1),":"==G.name.charAt(0)&&(G.name=":"+G.name),this.compileAttributeParts(V),w.push({type:Y,info:this.stringifyAttribute(V),value:V.value,ref:V.sourceValue||V.value}));break}default:Object.prototype.hasOwnProperty.call(V,"value")||(V.value=this.getDefaultAttributeValue(V)),C.push({type:Attr.NORMAL,attr:V});}}j=!1}j||this.parser.errorAt(m,"Tag was not closed."),h.index++;var H=function(t){var r=++e.level,a=C.map(function(t){var r=t.type,a=t.attr,s="["+(r<<3|mapAttributeType(a.type))+",";if(r==Attr.NORMAL)s+=""+(a.beforeName||"")+(a.computed?a.name:"\""+(a.name||"")+"\"")+((a.afterName||"")+", "+(a.beforeValue||"")+a.value+(a.optional?", 1":""));else if(r==Attr.INTERPOLATED){if(s+=""+a.beforeName+e.stringifyAttribute(a.before)+", ",e.options.es6)s+="["+a.inner.map(function(t){return t.spread?"..."+t.expr:e.stringifyAttribute(t)}).join(", ")+"]";else{var f={};s+=a.inner.map(function(t,r){var a=t.beforeValue;return 0==r?t.spread?a+=t.expr+".concat(":a+="Array("+e.stringifyAttribute(t):t.spread?a+=").concat("+t.expr:(!f.spread&&(a+=", "),a+=e.stringifyAttribute(t)),f=t,a+t.afterValue}).join(""),s+=")"}s+=", "+e.stringifyAttribute(a.after)+", "+(a.beforeValue||"")+a.value}else{for(var o,n=void 0,p=new Parser(a.expr.slice(1,-1)),i="";(n=p.find([","],!1,{comments:!0,strings:!0,regexp:!0})).pre;){if(o=n.pre.match(/^(\s*)this(\s*)\.(\s*)([a-zA-Z0-9_$]+)(\s*)$/),o){var d=_slicedToArray(o,6),u=d[1],l=d[2],c=d[3],m=d[4],h=d[5];i+=""+u+m+": this"+l+"."+c+m+h}else i+=n.pre;n.match&&(i+=n.match)}s+=a.space+"{"+i+"}"}return s+"]"}).join(", ")+"]";if(!t){var s=e.inherit.filter(function(e){return e&&(!e.level||-1!=e.level.indexOf(r))&&(!e.whitelist||-1!=e.whitelist.indexOf(N))}).map(function(e){return e.index});if(s.length)return e.options.es6?"["+s.map(function(e){return"..."+e+", "}).join("")+E.join("")+a:s.map(function(e){return"("+e+").concat"}).join("")+"(["+E.join("")+a+")"}return E.join("")+"["+a+(Object.prototype.hasOwnProperty.call(I,"widget")?", "+ +I.widget:"")};if(I.this?s="this":I.window?s="window":I.document?s=this.runtime+".document("+this.source.getContext()+")":I.html?s=this.runtime+".documentElement("+this.source.getContext()+")":I.root?s=this.runtime+".root("+this.source.getContext()+", "+(I.composed||0)+")":I.head?s=this.runtime+".head("+this.source.getContext()+")":I.body?s=this.runtime+".body("+this.source.getContext()+")":I.parent&&(s=I.parent),I.orphan&&(g=!1),!k)if(":"==N.charAt(0)){var Q=N.substr(1);if(this.options.aliases&&Object.prototype.hasOwnProperty.call(this.options.aliases,Q)){var Z=this.options.aliases[Q];N=Z.tagName,Object.prototype.hasOwnProperty.call(Z,"parent")&&(s=Z.parent),Object.prototype.hasOwnProperty.call(Z,"element")&&(o=Z.element),Object.prototype.hasOwnProperty.call(Z,"create")&&(y=Z.create),Object.prototype.hasOwnProperty.call(Z,"update")&&(x=Z.update),Object.prototype.hasOwnProperty.call(Z,"append")&&(g=Z.append),Object.prototype.hasOwnProperty.call(Z,"mode")&&(A=Z.mode)}else switch(Q){case"mode":A=p;break;case"window":o="window",y=g=!1;break;case"document":o=this.runtime+".document("+this.source.getContext()+")",y=g=!1;break;case"html":o=this.runtime+".documentElement("+this.source.getContext()+")",y=g=!1;break;case"root":o=this.runtime+".root("+this.source.getContext()+", "+(I.composed||0)+")",y=g=!1;break;case"head":case"body":o=this.runtime+"."+Q+"("+this.source.getContext()+")",y=g=!1;break;case"element":y=g=!1;break;case"this":o="this",y=g=!1;break;case"super":k=!0,N="super.render"+(p?"$"+p:"")+".bind(this)",C.unshift({type:Attr.NORMAL,attr:{type:"$",name:"",value:"arguments[0]"}});break;case"use":o=p,y=g=!1;break;case"query-all":n=!0;case"query":o=p,v=!0,y=g=!1;break;case"clone":o=p,S=!0,y=!1;break;case"adopt-all":n=!0;case"adopt":o=p,y=!1;break;case"slot":{p||(p="");var z=p.indexOf(",");-1==z?(l=p.trim(),N=""):(l=p.substr(z+1).trim(),N=p.substring(0,z).trim()),y=g=!1;break}case"inherit":{var J=O={};if(I.level||I.depth){J.level=I.level?I.level instanceof Array?I.level.map(function(e){return parseInt(e)}):[parseInt(I.level)]:[1],I.depth&&function(){var t=parseInt(I.depth);isNaN(t)&&e.parser.error("Depth is not a valid number.");for(var r=[],a=function(e){J.level.forEach(function(t){r.push(t+e)})},e=0;s<t;s++)a(e);J.level=r}();for(var c=0;c<J.level.length;c++)J.level[c]+=this.level}I.whitelist&&(J.whitelist=[].concat(I.whitelist).map(function(e){return JSON.parse(e)})),y=x=g=!1;break}case"scope":case"debug":case"bind":case"unbind":y=x=g=!1;break;default:this.parser.error("No special meaning associated to `<:"+Q+" />` tag.");}}else if("#"==N.charAt(0)){var i=N.substr(1);N=/^[a-zA-Z]+$/.test(i)?this.runtime+".widgets."+i:this.runtime+".widgets[\""+i+"\"]",k=!0}else N&&(Object.prototype.hasOwnProperty.call(this.tagNames,N)?this.tagNames[N]++:this.tagNames[N]=1);if(I.mode&&(A=I.mode.slice(1,-1)),A){var ee=A;A=modeNames[A],void 0===A&&this.parser.error("Unknown mode \""+ee+"\".")}else for(var te,re=0;re<modeRegistry.length;re++)if(te=modeRegistry[re],te.parser.matchesTag&&te.parser.matchesTag(N,this.currentMode.parser)){A=re;break}if(void 0!==A){var ae={};for(var se in I)try{var oe=JSON.parse(I[se]);ae[se]=""===oe||oe}catch(t){}var ne=this.startMode(A,ae);C.push.apply(C,_toConsumableArray(ne.usedAttributes().map(function(e){return{type:Attr.NORMAL,attr:e}})))}var pe=!1;if(k||":mode"!=N)if((!k&&":debug"==N||I.debug)&&(this.source.push("if("+this.runtime+".isDebug) {"),T.unshift("}")),":bind"==N||":unbind"==N){var ie=function(e){return Array.isArray(e)?e.join(", "):e||""};if(this.source.addSource(this.feature(N.substr(1))+"("),this.source.addContext(),this.source.addSource(", ["+ie(I.to)+"], ["+ie(I["maybe-to"])+"], "),this.options.es6){if(I.as){var de=I.as;Array.isArray(de)?de="["+de.join(", ")+"]":("["!=de.charAt(0)||"]"!=de.charAt(de.length-1))&&(de="["+de+"]"),this.source.addSource("("+this.source.getContext()+", "+this.value+") => {var "+de+"="+this.value+".map("+this.runtime+".value);")}else this.source.addSource(this.source.getContext()+" => {");T.unshift("})")}else I.as&&this.parser.error("Attribute `as` can only be used when transpiling in es6 mode."),this.source.addSource("function("+this.source.getContext()+"){"),T.unshift("}.bind(this))")}else{I.unique&&(this.source.addSource(this.feature("unique")+"("),this.source.addContext(),this.source.addSource(", "+this.nextId()+", "),this.options.es6?(this.source.addSource("() => "),T.unshift(")")):(this.source.addSource("function(){return "),T.unshift("}.bind(this))")));var a=[],F=[],_="";if(v){var ue=[this.chainFeature("query"),o];s&&ue.push(s),a.push(ue)}else if(S){var le=[this.chainFeature("clone"),o];Object.prototype.hasOwnProperty.call(I,"deep")&&le.push(+I.deep),a.push(le)}else if(l){var ce=[this.chainFeature("slot"),"\""+l+"\""];N&&ce.push("\""+N+"\""),a.push(ce),g=!1}else o&&a.push([this.chainFeature("use"),o]);if(Object.prototype.hasOwnProperty.call(I,"namespace")&&a.push([this.chainFeature("namespace"),I.namespace]),y){var me=[this.chainFeature(P?"createIf":"create"),0,0,H()];k?(me[1]=N,u&&(me[2]=JSON.stringify(u))):me[1]="\""+N+"\"",a.push(me)}else if(x){I.clear&&a.push([this.chainFeature("clear")]);var he=H().toString();2<he.length&&a.push([this.chainFeature("update"),he])}I.ref&&a.push([this.chainFeature("ref")].concat(_toConsumableArray([].concat(I.ref).map(function(t){return e.options.es6?e.value+" => "+t+"="+e.value:"function("+e.value+"){"+t+"="+e.value+"}.bind(this)"})))),I["ref-widget"]&&a.push([this.chainFeature("refWidget")].concat(_toConsumableArray([].concat(I["ref-widget"]).map(function(t){return e.options.es6?e.value+" => "+t+"="+e.value:"function("+e.value+"){"+t+"="+e.value+"}.bind(this)"})))),w.length&&F.push([this.chainFeature("bind"),w.map(function(t){var r=t.type,a=t.info,s=t.value,o=t.ref,n=["\""+r+"\"",a,s];return e.options.es6?n.push(e.value+" => {"+o+"="+e.value+"}"):n.push("function("+e.value+"){"+o+"="+e.value+"}.bind(this)"),"["+n.join(", ")+"]"}).join(", ")]);var fe=I.early?a:F;if(g){var be="append";s&&(be+="To"),P&&(be+="If");var ye=[this.chainFeature(be)];s&&ye.push(s),fe.push(ye)}var xe=this.currentMode.parser.chainAfter();xe&&F.push(xe),Array.isArray(I.slot)||(I.slot=I.slot?[I.slot]:[]),I["slot-content"]&&I.slot.push(this.runtime+".SL_CONTENT"),I["slot-container"]&&I.slot.push(this.runtime+".SL_CONTAINER"),I["slot-input"]&&I.slot.push(this.runtime+".SL_INPUT"),I.slot.length&&a.push([this.chainFeature("slots"),"["+I.slot.map(function(e){return!0===e?0:e}).join(", ")+"]"]),"/"==j&&(this.parser.expect(">"),pe=!0),a.length||F.length||a.push([this.chainFeature("nop")]);var W=function(e){return", ["+e.join(", ")+"]"};this.source.uses.chain=!0,this.source.addSource(""+this.chain+(n?".all":"")+"("),I.context?this.source.addSource(I.context):this.source.addContext(),this.source.addSource(a.map(W).join("")),pe||(this.source.addSource(", ["+this.chainFeature("body")+", "),this.options.es6?(this.source.addContext(),this.source.addSource(" => {"),_+="}"):(this.source.addSource("function("),this.source.addContext(),this.source.addSource("){"),_+="}.bind(this)")),T.unshift((pe?"":"]")+F.map(W).join("")+f+")"),T.unshift(_),!pe&&O&&this.source.push((this.options.es6?"const":"var")+" "+(O.index=this.nextVarName())+"="+H(!0)+";")}T=T.join(""),pe?(void 0!==A&&this.endMode(),this.source.push(T),this.addSemicolon(),this.level--):(this.inherit.push(O),this.closing.push(T),this.tags.push({tagName:d,position:m,mode:void 0!==A,sourceIndex:this.source.length}),void 0!==A&&this.currentMode.parser.start())}this.parser.last=void 0},Transpiler.prototype.isSpreadAttribute=function(){return"..."==this.parser.input.substr(this.parser.index,3)&&(this.parser.index+=3,!0)},Transpiler.prototype.parseAttributeName=function(e){for(var t,r={computed:!1,parts:[]},a=e;;){if(t={},t.name=this.parser.readComputedExpr())r.computed=t.computed=!0,"["==t.name.charAt(0)&&"]"==t.name.charAt(t.name.length-1)?(t.name=t.name.slice(1,-1),t.name="["==t.name.charAt(0)?this.runtime+".config.s"+t.name:this.runtime+".config.s[\""+t.name+"\"]"):t.name=this.parseCode(t.name).source;else if(!(t.name=this.parser.readAttributeName(a)))break;r.parts.push(t),a=!1}return r},Transpiler.prototype.getDefaultAttributeValue=function(e){var t=e.type,r=e.negated;switch(t){case"":return"\"\"";case"@":case"$":case"~":case"$$":return!r;case"+":return 0;case"&":if(r)return"!1";}this.parser.error("Value for attribute is required.")},Transpiler.prototype.compileAttributeParts=function(e){if(e.computed){var t=[];e.parts.forEach(function(e){e.computed?t.push("("+e.name+")"):t.push(JSON.stringify(e.name))}),e.name=this.feature("attr")+"("+t.join(", ")+")"}else e.name=e.parts.map(function(e){return e.name}).join("")},Transpiler.prototype.stringifyAttribute=function(e){return e.computed?e.name:"\""+e.name+"\""},Transpiler.prototype.feature=function(e){return this.features[e]=!0,this.runtime+"."+e},Transpiler.prototype.chainFeature=function(e){return this.features["chain."+e]=!0,this.chain+"."+e},Transpiler.prototype.transpile=function(e){function t(e){Object.prototype.hasOwnProperty.call(dependencies,e)&&dependencies[e].forEach(function(e){s[e]=!0,t(e)})}var r=this,a=now();this.parser=new Parser(e),this.source=new Generated(this),this.count=hash((this.options.namespace||this.options.filename)+"")%1e5,this.runtime=this.nextVar(),this.chain=this.nextVar(),this.context0=this.nextVar(),this.context1=this.nextVar(),this.value=this.nextVar(),this.tagNames={};var s=this.features={};this.warnings=[],this.tags=[],this.inherit=[],this.closing=[],this.modes=[],this.level=0,this.startMode(this.options.mode&&modeNames[this.options.mode]||defaultMode,this.options.modeAttributes||{}).start();for(var o=Transpiler.prototype.open.bind(this),n=Transpiler.prototype.close.bind(this);!this.parser.eof();)this.updateTemplateLiteralParser(),this.currentMode.parser.parse(o,n);this.endMode();var p=Transpiler.VERSION||version&&version.version,i=1<this.options.env.length,d=!i&&"none"==this.options.env[0];if(this.after="",this.before="/*! Transpiled"+(this.options.filename?" from "+this.options.filename:"")+" using Sactory v"+p+". Do not edit manually. */",d?this.before+="var "+this.runtime+"="+(this.options.runtime||"Sactory")+";":(i&&(this.before+="!function(a,b){"),-1!=this.options.env.indexOf("amd")&&(i&&(this.before+="if(typeof define=='function'&&define.amd){"),this.before+=(this.options.amd&&this.options.amd.anonymous?"require":"define")+"(['"+(this.options.amd&&this.options.amd.runtime||this.options.runtime||"sactory")+"'"+this.calcDeps("amd",",'","'")+"],",i&&(this.before+="b)}else ")),-1!=this.options.env.indexOf("commonjs")&&(i?this.before+="if(typeof exports=='object'){module.exports=b(require('"+(this.options.commonjs&&this.options.commonjs.runtime||this.options.runtime||"sactory")+"')"+this.calcDeps("commonjs",",require('","')")+")}else ":(this.before+="var "+this.runtime+"=require('"+(this.options.commonjs&&this.options.commonjs.runtime||this.options.runtime||"sactory")+"');",d=!0)),-1==this.options.env.indexOf("none")?i&&(this.before=this.before.slice(0,-5)):(this.before+="{",this.options.globalExport&&(this.before+="a."+this.options.globalExport+"="),this.before+="b("+(this.options.runtime||"Sactory")+this.calcDeps("none",",","")+")}"),!d&&(i&&(this.before+="}(this,"),this.before+="function("+this.runtime,this.options.dependencies&&(this.before+=","+Object.keys(this.options.dependencies).join(",")),this.before+="){")),this.options.before&&(this.before+=this.options.before),this.options.versionCheck&&(this.before+=this.runtime+".check(\""+p+"\");"),this.source.uses.chain&&(this.before+="var "+this.chain+"="+this.runtime+".chain;"),this.source.uses.context){var l=[];this.options.element&&l.push("element:"+this.options.element),this.options.anchor&&l.push("anchor:"+this.options.anchor),this.options.bind&&l.push("bind:"+this.options.bind),this.before+="var "+this.context0+"={"+l.join(",")+"};"}this.options.after&&(this.after+=this.options.after),d||(this.after+="}.bind(this));");var u=this.source.toString();return Object.keys(s).forEach(t),this.options.silent||this.warnings.forEach(function(e){var t=e.message,a=e.position;return console.warn(r.options.filename+"["+(a.line+1)+":"+a.column+"]: "+t)}),{time:now()-a,variables:{runtime:this.runtime,chain:this.chain,context0:this.context0,context1:this.context1},scope:this.options.scope,sequence:this.count,tags:this.tagNames,features:Object.keys(s).sort(),warnings:this.warnings,source:{before:this.before,after:this.after,all:this.before+u+this.after,contentOnly:u}}},Transpiler.prototype.calcDeps=function(e,t,r){var a="";if(this.options.dependencies)for(var s in this.options.dependencies){var o=this.options.dependencies[s];"string"==typeof o?a+=t+o+r:o[e]&&(a+=t+o[e]+r)}return a};var dependencies={"chain.query":["chain.use"],"chain.update":["chain.updateImpl"],"chain.create":["chain.updateImpl"],"chain.createIf":["chain.update","chain.create"],"chain.mixin":["chain.appendTo","chain.html"],"chain.append":["chain.appendTo"],"chain.appendToIf":["chain.appendTo"],"chain.appendIf":["chain.append"],comment:["anchor"],bind:["anchor"],bindIfElse:["anchor"],bindEach:["anchor"],bindEachMaybe:["bindEach","forEachArray"],convertStyle:["compileStyle"],cabs:["convertStyle"]};Transpiler.eval=function(e){return eval.call(window,new Transpiler({versionCheck:!1,mode:"auto-code"}).transpile(e).source.all)};var count=0,es6=!1;try{eval("es6 = class {}, true")}catch(t){}return"complete"==document.readyState?evalScripts():window.addEventListener("load",evalScripts),Transpiler});
//# sourceMappingURL=maps/transpiler.min.js.map
