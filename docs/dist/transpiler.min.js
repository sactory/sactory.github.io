!function(e){"function"==typeof define&&define.amd?define(e):window.Transpiler=e()}(function(){function e(){return Object.toString().replace(/Object/,"Transpiler").replace(/native/,"sactory")}function t(e,t){Object.defineProperty(g,e,{get:function(){return t}})}g.toString=e.toString=e,t("VERSION_MAJOR",0),t("VERSION_MINOR",102),t("VERSION_PATCH",0),t("VERSION","0.102.0");var pe={};pe.startsWith=String.prototype.startsWith||function(e,t){return t=!t||t<0?0:+t,this.substring(t,t+e.length)===e},pe.endsWith=String.prototype.endsWith||function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e},pe.trimStart=String.prototype.trimStart||function(){return this.replace(/^[\s\uFEFF\xA0]+/g,"")},pe.trimEnd=String.prototype.trimEnd||function(){return this.replace(/[\s\uFEFF\xA0]+$/g,"")},pe.padStart=String.prototype.padStart||function(e,t){for(var s=String(this);s.length<e;)s=t+s;return s},pe.assign=Object.assign||function(e,t){for(var s in t)e[s]=t[s];return e};var ue={};function s(e,t){Object.defineProperty(ue,e,{value:t})}function a(e,t,s){var r=new Error(e,t,s);return Object.setPrototypeOf?Object.setPrototypeOf(r,Object.getPrototypeOf(this)):r.__proto__=this.__proto__,Error.captureStackTrace&&Error.captureStackTrace(r,a),r}function y(e,t){this.index=0,this.input=e,this.last=void 0,this.lastIndex=void 0,this.parseTemplateLiteral=null,this.parentheses=[],this.lastParenthesis=void 0,this.options={},this.from=t||{}}function p(s){return s.filter(function(e,t){return s.indexOf(e)==t})}function ce(e){return'"'+e.replace(/(\r?\n)|([\\"])/gm,function(e,t,s){return t?"\\n\\\n":"\\"+s})+'"'}function o(){return performance.now?performance.now():(new Date).getTime()}s("BUILDER_TYPE_NONE",0),s("BUILDER_TYPE_PROP",1),s("BUILDER_TYPE_CONCAT",2),s("BUILDER_TYPE_ON",3),s("BUILDER_TYPE_WIDGET",4),s("BUILDER_TYPE_EXTEND_WIDGET",5),s("OBSERVABLE_UPDATE_TYPE_ARRAY_PUSH",1048571),s("OBSERVABLE_UPDATE_TYPE_ARRAY_POP",1048572),s("OBSERVABLE_UPDATE_TYPE_ARRAY_UNSHIFT",1048573),s("OBSERVABLE_UPDATE_TYPE_ARRAY_SHIFT",1048574),s("OBSERVABLE_UPDATE_TYPE_ARRAY_SPLICE",1048575),s("OBSERVABLE_UPDATE_TYPE_FORM_RANGE_START",1048576),s("OBSERVABLE_UPDATE_TYPE_FORM_RANGE_LENGTH",1048576),(a.prototype=Object.create(Error.prototype,{constructor:{value:Error,enumerable:!1,writable:!1,configurable:!1}})).name="ParserError",Object.defineProperty(y.prototype,"position",{get:function(){for(var e=0,t=0,s=0;s<=this.index;s++)"\n"==this.input.charAt(s)?(e++,t=-1):t++;return{absolute:this.index+(this.from&&this.from.absolute-this.input.length||0),index:this.index,line:e+(this.from&&this.from.line-(this.input.match(/\n/g)||[]).length||0),column:Math.max(0,t)+(this.from&&this.from.column-this.input.length||0)}}}),y.prototype.error=function(e){this.errorAt(this.position,e)},y.prototype.errorAt=function(e,t){var s=this.input.substr(e.index).indexOf("\n"),r=this.input.substring(0,e.index).lastIndexOf("\n")+1,i=-1==s?this.input.length:e.index+s;t+="\n"+this.input.substring(r,i)+"\n";for(var n=r;n<i;n++)t+=n==e.index?"^":"\t"==this.input.charAt(n)?"\t":" ";throw new a("Line "+(e.line+1)+", Column "+e.column+": "+t)},y.prototype.eof=function(){return this.index>=this.input.length},y.prototype.peek=function(){return this.input[this.index]},y.prototype.read=function(){return this.input[this.index++]},y.prototype.readIf=function(e){if(this.peek()===e)return this.read()},y.prototype.expect=function(e){var t=this.input[this.index++];t!==e&&(this.index--,this.error("Expected '"+e+"' but got '"+t+"'."))},y.prototype.expectSequence=function(e){e!=this.input.substr(this.index,e.length)?this.error("Expected '"+e+"'."):this.index+=e.length},y.prototype.lastKeywordAt=function(e,t){return this.input.charAt(e)===t.charAt(t.length-1)&&this.input.substring(e-t.length+1,e+1)==t&&!/[a-zA-Z0-9_$\.]/.test(this.input.charAt(e-t.length))},y.prototype.lastKeywordAtIn=function(e){for(var t=1;t<arguments.length;t++)if(this.lastKeywordAt(e,arguments[t]))return!0;return!1},y.prototype.lastKeyword=function(e){return this.lastKeywordAt(this.lastIndex,e)},y.prototype.lastKeywordIn=function(){for(var e=0;e<arguments.length;e++)if(this.lastKeyword(arguments[e]))return!0;return!1},y.prototype.couldStartRegExp=function(){return void 0===this.last||!this.last.match(/^[a-zA-Z0-9_$\)\]\.]$/)||this.lastKeywordIn("return","throw","typeof","do","in","instanceof","new","delete","else")||")"==this.last&&void 0!==this.lastParenthesis&&this.lastKeywordAtIn(this.lastParenthesis,"if","else","for","while")||/\n/.test(this.input.substring(this.lastIndex,this.index))&&this.lastKeywordIn("++","--","break","continue")},y.prototype.skipImpl=function(e){this.index;for(var t=this.last,s=this.lastIndex,r="";!this.eof();){var i,n=this.peek();if(!1!==e.whitespaces&&/\s/.test(n))r+=this.read();else if(!1!==e.comments&&"/"==n&&("/"==(i=this.input[this.index+1])&&!1!==e.inlineComments||"*"==i))r+=this.read()+this.read()+("/"==i?this.findSequence("\n",!1):this.findSequence("*/",!1)),this.last=void 0;else if(!1===e.strings||'"'!=n&&"'"!=n&&"`"!=n){if(!0!==e.regexp||"/"!=n||!this.couldStartRegExp()){this.last=t,this.lastIndex=s,t=n,s=this.index;break}r+=this.skipRegExp()}else r+=this.skipString()}return r},y.prototype.skip=function(){return this.skipImpl(this.options)},y.prototype.skipEscapableContent=function(e){var t=this.position,s=this.read(),r=["\\",s];"`"==s&&r.push("$");for(var i=s;!this.eof();){var n=this.find(r,!1,!1);if(i+=n.pre,n.match)if("\\"==n.match)i+="\\"+this.read();else{if("$"!=n.match||"{"!=this.peek())break;var a=this.skipEnclosedContent().slice(1,-1);i+="${"+("function"==typeof this.parseTemplateLiteral?this.parseTemplateLiteral(a,this):a)+"}"}else this.error("Could not find end of "+e()+" started at line "+t.line+" column "+t.column)}return i+s},y.prototype.skipString=function(){var e=this.skipEscapableContent(function(){return"string"});return this.last=this.input[this.lastIndex=this.index],e},y.prototype.skipRegExp=function(){for(var e,t=this.skipEscapableContent(function(){return"regular expression"}),s=["g","i","m","s","u","y"];-1!=(e=s.indexOf(this.peek()));)s.splice(e,1),t+=this.read();return this.last=this.input[this.lastIndex=this.index],t},y.prototype.skipEnclosedContent=function(e){this.lastEnclosureIndex=this.index;for(var t={"}":"{","]":"[",")":"("},s=this.read(),r={"{":0,"[":0,"(":0};!this.eof();){var i=this.find(["{","}","[","]","(",")"],!0,{comments:!0,strings:!0,regexp:!0});s+=i.pre+i.match;var n=t[i.match],a=r[i.match];if(n){if(r[n]--,r[n]<0)return e?s.slice(1,-1):s}else void 0!==a&&r[i.match]++}this.error("Expression not completed.")},y.prototype.find=function(e,t,s){for(var r="";!this.eof();){s&&(r+="object"==typeof s?this.skipImpl(s):this.skip());var i=this.input[this.index++];if(-1!=e.indexOf(i))return{pre:r,match:i};i&&(r+=i),this.last=i,this.lastIndex=this.index-1}return t&&this.eof()&&this.error("Expected ["+e.join(", ")+"] but none found."),{pre:r}},y.prototype.findSequence=function(e,t){var s=this.input.substr(this.index).indexOf(e);-1==s&&(t?this.error("Could not find sequence '"+e+"'."):s=this.input.length);var r=this.input.substr(this.index,s+e.length);return this.index+=s+e.length,r},y.prototype.readImpl=function(e,t,s){var r=e.exec(this.input.substr(this.index));return r?(this.index+=r[0].length,r[0]):!!t&&void this.error(s&&s()||"Regular expression '"+e+"' could not be satisfied.")},y.prototype.readVarName=function(e){return this.readImpl(/^[a-zA-Z_$][a-zA-Z0-9_$]*/,e,function(){return"Could not find a valid variable name."})},y.prototype.readTagName=function(e){return this.readImpl(/^(#[a-z]+|[a-zA-Z0-9:-]+|@)/,e,function(){return"Could not find a valid tag name."})},y.prototype.readAttributePrefix=function(){var e=/^(?:([:#@*~+]|\$\$?)|(dir|sdir|mode|attr|prop|on|concat|widget|extend):)/.exec(this.input.substr(this.index));return!!e&&(this.index+=e[0].length,e[1]||{dir:":",sdir:"*",mode:"#",attr:"",prop:"@",concat:"~",on:"+",widget:"$",extend:"$$"}[e[2]])},y.prototype.readAttributeName=function(e){return this.readImpl(/^[a-zA-Z0-9_$@.:!-]+/,e,function(){return"Could not find a valid attribute name."})},y.prototype.readComputedExpr=function(){return"["==this.peek()&&this.skipEnclosedContent().slice(1,-1)},y.prototype.readQueryExpr=function(){var e=this.peek();return"{"==e?this.skipEnclosedContent().slice(1,-1):('"'==e||"'"==e||"`"==e)&&this.skipString()},y.prototype.readSingleExpression=function(e){var t,s=this.readImpl(/^([-+~!]*((new|delete|typeof)\s+)?(\*[*?]?|\^\??)?@{0,2})/)||"";for(e&&(s+=this.skipImpl({strings:!1})),s+='"'==(t=this.peek())||"'"==t||"`"==t?this.skipString():"/"==t?this.skipRegExp():this.readImpl(/^(([a-zA-Z_$][a-zA-Z0-9_$]*)|0[box][0-9]+|([0-9]*\.?[0-9]+([eE][+-]?[0-9]+)?))/,!1)||"";!this.eof();){var r={ret:s,index:this.index};e&&(s+=this.skipImpl({strings:!1}));var i=this.readImpl(/^(\.([*^]\??)?#?[a-zA-Z0-9_$]+)/,!1);if(i&&(s+=i,e&&(s+=this.skipImpl({strings:!1}))),"{"==(t=this.peek())||"["==t||"("==t)s+=this.skipEnclosedContent();else if(!i){s=r.ret,this.index=r.index;break}}return"+"!=(t=this.peek())&&"-"!=t||this.input.charAt(this.index+1)!=t||(s+=this.read()+this.read()),s},y.prototype.readExpression=function(){var e,t=this.skipImpl({strings:!1});if(e=this.readSingleExpression(!0))for(t+=e+this.skipImpl({strings:!1});!this.eof()&&(e=this.readImpl(/^(\*\*|&&?|\|\|?|\^|=>|==?=?|!==?|<<|>>>?|\?|:|[\+\-\*\/%<>]=?|in(stanceof)?\s)/,!1));)t+=e+this.skipImpl({strings:!1}),(e=this.readSingleExpression(!0)).trim()||this.error("Could not find a valid expression."),t+=e+this.skipImpl({strings:!1});if(t.trim())return t;this.error("Could not find a valid expression.")},y.prototype.readAttributeValue=function(){return this.readSingleExpression(!1)||this.error("Could not find a valid expression for the attribute's value.")},y.prototype.readVar=function(e){return"{"==this.peek()?"("+this.skipEnclosedContent().slice(1,-1)+")":this.readVarName(e)};var u,r,le=[],de={};function n(e,t,s,r){this.transpiler=e,this.parser=t,this.source=s,this.runtime=e.runtime,this.element=e.element,this.bind=e.bind,this.anchor=e.anchor,this.attributes=r}function i(e,t,s,r,i){n.call(this,e,t,s,r),this.breakpoints=["<"].concat(i)}function c(e,t,s,r){n.call(this,e,t,s,r),this.current=[]}function h(e,t,s,r){c.call(this,e,t,s,r),this.count=0,this.statements=[],this.popped=[]}function l(e,t,s,r){h.call(this,e,t,s,r),r.logic||(this.parse=c.prototype.parse.bind(this))}function d(e,t,s,r){i.call(this,e,t,s,r,["(",")","@","*","^"]),this.observables=[],this.maybeObservables=[],this.parentheses=[]}function f(e,t,s,r){l.call(this,e,t,s,r)}function m(e,t,s,r){c.call(this,e,t,s,r)}function b(e,t,s,r){l.call(this,e,t,s,r)}function v(e,t,s,r){h.call(this,e,t,s,r),this.observables=[],this.maybeObservables=[],this.expr=[],this.scopes=[e.nextVarName()],this.scope=r.scope,this.scoped=!!r.scoped,this.inExpr=!1}function g(e){this.options=e||{}}g.defineMode=function(e,t,s){var r=le.length;return le.push({name:e[0],parser:t}),e.forEach(function(e){de[e]=r}),s&&(u=r),r},g.getModeByName=function(e){return de[e]},g.replaceMode=function(e,t){le[e].parser=t},g.startMode=function(e,t,s,r,i){var n=le[e],a=new n.parser(t,s,r,i||{});return a.options=s.options=n.parser.getOptions(),a},n.prototype.add=function(e){this.source.push(e)},n.prototype.parseCode=function(e){this.parser.parseTemplateLiteral=null;var t=y.prototype[e].apply(this.parser,Array.prototype.slice.call(arguments,1));return this.transpiler.updateTemplateLiteralParser(),this.transpiler.parseCode(t,this.parser)},n.prototype.parseCodeToSource=function(e){var t=y.prototype[e].apply(this.parser,Array.prototype.slice.call(arguments,1));return this.transpiler.parseCode(t,this.parser).source},n.prototype.parseCodeToValue=function(e){return this.parseCode.apply(this,arguments).toValue()},n.prototype.start=function(){},n.prototype.end=function(){},n.prototype.afterappend=function(){},n.prototype.beforeremove=function(){},n.prototype.parse=function(e,t){},(i.prototype=Object.create(n.prototype)).next=function(e){},i.prototype.parse=function(e,t){var s=this.parser.find(this.breakpoints,!1,!0);s.pre&&this.add(s.pre),"<"==s.match?this.parser.options.code&&!this.parser.couldStartRegExp()?(this.add("<"),this.parser.last="<",this.parser.lastIndex=this.parser.index):e():s.match?this.next(s.match):t()},(c.prototype=Object.create(n.prototype)).addText=function(e){this.add(this.runtime+"."+this.transpiler.feature("text")+"("+this.element+", "+this.bind+", "+this.anchor+", "+e+");")},c.prototype.addCurrent=function(){if(this.attributes.trimmed&&1==this.current.length&&this.current[0].text&&/^\s*$/.test(this.current[0].value))this.add(this.current[0].value);else{var e=[],t=[],s=[];for(var r in this.current){var i=this.current[r];i.text?i.value.length&&e.push(ce(this.replaceText(i.value))):(Array.prototype.push.apply(t,i.value.observables),Array.prototype.push.apply(s,i.value.maybeObservables),e.push("("+i.value.source+")"))}if(e.length){var n=e.join(" + ");(t.length||s.length)&&(n=this.runtime+"."+this.transpiler.feature(s.length?"maybeComputedObservable":"computedObservable")+"(this, "+this.bind+", ["+p(t).join(", ")+"], function(){return "+n+"}"+(s.length?", ["+s.join(", ")+"]":"")+")"),this.addText(n)}}this.current=[]},c.prototype.addFinalCurrent=function(){this.addCurrent()},c.prototype.pushText=function(e){var t=this.current[this.current.length-1];t&&t.text?t.value+=e:this.current.push({text:!0,value:e})},c.prototype.pushExpr=function(e){this.current.push({text:!1,value:e})},c.prototype.trimEnd=function(){var e="",t=this.current[this.current.length-1];if(t.text){var s=pe.trimEnd.call(t.value);e=t.value.substr(s.length),t.value=s}return e},c.prototype.replaceText=function(e){return e},c.prototype.handle=function(){return!0},c.prototype.parseImpl=function(e,t,s,r){switch(t){case"$":case"#":if("\\"==e.slice(-1)){this.current[this.current.length-1].value=this.current[this.current.length-1].value.slice(0,-1)+t;break}if("{"==this.parser.peek()){var i=this.parseCode("skipEnclosedContent",!0);"#"==t?(this.addCurrent(),this.add(this.runtime+"."+this.transpiler.feature("mixin")+"("+this.element+", "+this.bind+", "+this.anchor+", "+i.source+");")):this.pushExpr(i)}else this.pushText(t);break;case"<":this.handle()?(this.addFinalCurrent(),s()):this.pushText("<");break;default:this.addFinalCurrent(),r()}},c.prototype.parse=function(e,t){var s=this.parser.find(["<","$","#"],!1,!0);this.pushText(s.pre),this.parseImpl(s.pre,s.match,e,t)},(h.prototype=Object.create(c.prototype)).getLineText=function(){var e=this.current[this.current.length-1];if(e.text){var t=e.value.lastIndexOf("\n");return 0<t?e.value.substr(t):e.value}return""},h.prototype.parseLogic=function(e,t){var s;if(this.parser.input.substr(this.parser.index,e.length-1)!=e.substr(1)||/\S/.test(s=this.getLineText())||/[a-zA-Z0-9_$]/.test(this.parser.input.charAt(this.parser.index+e.length-1))){if(s&&"\\"==s.slice(-1)){var r=this.current[this.current.length-1];r.value=r.value.slice(0,-1)}return!1}this.parser.index+=e.length-1;var i=this.trimEnd();if(this.addCurrent(),this.add(i),0===t){var n=this.parser.find(["=",";"],!0,{comments:!0,strings:!1});this.add(e+n.pre+n.match),"="==n.match&&(this.add(this.transpiler.parseCode(this.parser.readExpression()).source),this.parser.readIf(";")&&this.add(";"))}else{var a=pe.startsWith.call(e,"else")?this.popped.pop():{type:e,startIndex:this.source.length,observables:[],maybeObservables:[],inlineable:!0,end:"",parts:[]},o={type:e,observables:[],maybeObservables:[],declStart:this.source.length};if(a.parts.push(o),1===t){var h=this.transpiler;function p(e,t){var s=h.parseCode(e,t);return Array.prototype.push.apply(a.observables,s.observables),Array.prototype.push.apply(a.maybeObservables,s.maybeObservables),Array.prototype.push.apply(o.observables,s.observables),Array.prototype.push.apply(o.maybeObservables,s.maybeObservables),s.source}var u=this.parser.skipImpl({});"("!=this.parser.peek()&&this.parser.error("Expected '(' after '"+e+"'.");var c=this.parser.position,l=p(this.parser.skipEnclosedContent(),this.parser);if("foreach"==e){var d,f,m,b=new y(l.slice(1,-1),c);b.options={comments:!0,strings:!0,regexp:!0},u+=b.skipImpl({comments:!0,strings:!1}),pe.startsWith.call(b.input.substr(b.index),"from ")?(b.index+=5,f=p(b.readExpression()),b.expectSequence("to "),m=p(b.readExpression())):pe.startsWith.call(b.input.substr(b.index),"to ")?(b.index+=3,f="0",m=p(b.readExpression())):d=b.readExpression();var v="";"as "==b.input.substr(b.index,3)&&(b.index+=3,v=b.input.substr(b.index)),d?(this.add(this.runtime+"."+this.transpiler.feature("forEach")+"(this, "),this.add(d),this.add(", function("),this.add(v+")")):(a.type=o.type="range",this.add(this.runtime+"."+this.transpiler.feature("range")+"(this, "+f+", "+m+", function("+v+")")),a.inlineable=!1,a.end=");"}else this.add(e+u+l)}else this.add(e);this.add(this.parser.skipImpl({})),(a.inline=o.inline=!this.parser.readIf("{"))&&a.inlineable||this.add("{"),o.declEnd=this.source.length,this.statements.push(a),this.onStatementStart(a)}return!0},h.prototype.find=function(){return this.parser.find(["$","#","<","v","c","l","i","e","f","w","}","\n"],!1,!1)},h.prototype.parse=function(e,t){var s=this.find();switch(this.pushText(s.pre),s.match){case"c":this.parseLogic("const",0)||this.pushText("c");break;case"l":this.parseLogic("let",0)||this.pushText("l");break;case"v":this.parseLogic("var",0)||this.pushText("v");break;case"i":this.parseLogic("if",1)||this.pushText("i");break;case"e":this.parseLogic("else if",1)||this.parseLogic("else",2)||this.pushText("e");break;case"f":this.parseLogic("foreach",1)||this.parseLogic("for",1)||this.pushText("f");break;case"w":this.parseLogic("while",1)||this.pushText("w");break;case"}":if("\\"==s.pre.slice(-1)){var r=this.current[this.current.length-1];r.value=r.value.slice(0,-1)+"}"}else if(this.statements.length){var i=this.trimEnd();this.addCurrent(),this.add(i),this.add("}"),(n=this.statements.pop()).endIndex=this.source.length,n.parts[n.parts.length-1].close=this.source.length-1,this.popped.push(n),this.onStatementEnd(n)}else this.pushText("}");break;case"\n":if(this.statements.length&&this.statements[this.statements.length-1].inline){var n;i=this.trimEnd();this.addCurrent(),this.add(i),this.add("\n"),(n=this.statements.pop()).inlineable||(this.source[this.source.length-1]+="}"),n.endIndex=this.source.length,n.parts[n.parts.length-1].close=this.source.length-1,this.popped.push(n),this.onStatementEnd(n)}else this.pushText("\n");break;default:this.parseImpl(s.pre,s.match,e,t)}},h.prototype.onStatementStart=function(e){},h.prototype.onStatementEnd=function(e){},h.prototype.end=function(){for(var e=0;e<this.popped.length;e++){var t=this.popped[e];if(!!t.observables.length||!!t.maybeObservables.length)if("if"==t.type){var s=[],r=", function("+this.element+", "+this.bind+", "+this.anchor+")";t.parts.forEach(function(e){var t=this.source[e.declStart].substr(e.type.length);"else"==e.type?s.push("[]"):s.push("[function(){return "+t+"}, ["+p(e.observables)+"]"+(e.maybeObservables.length?", ["+p(e.maybeObservables)+"]":"")+"]"),this.source[e.declStart]=r,e.inline&&(this.source[e.declStart]+="{",this.source[e.close]+="}")}.bind(this)),this.source[t.startIndex]=this.runtime+"."+this.transpiler.feature("bindIfElse")+"(this, "+this.element+", "+this.bind+", "+this.anchor+", ["+s.join(", ")+"]"+this.source[t.startIndex],this.source[t.endIndex]=");"+this.source[t.endIndex]}else if("foreach"==t.type){var i=this.source[t.startIndex+1];this.source[t.startIndex]="",this.source[t.startIndex+1]="",this.source[t.startIndex+2]=this.runtime+"."+this.transpiler.feature("bindEach"+(t.maybeObservables.length?"Maybe":""))+"(this, "+this.element+", "+this.bind+", "+this.anchor+", "+(t.maybeObservables.length?t.maybeObservables[0]:t.observables[0])+", function(){return "+i+"}, function("+this.element+", "+this.bind+", "+this.anchor+", "}else this.source[t.startIndex]=this.runtime+"."+this.transpiler.feature("bind")+"(this, "+this.element+", "+this.bind+", "+this.anchor+", ["+p(t.observables).join(", ")+"]"+(t.maybeObservables.length?".concat("+this.runtime+"."+this.transpiler.feature("filterObservables")+"(["+p(t.maybeObservables)+"]))":"")+", function("+this.element+", "+this.bind+", "+this.anchor+"){"+this.source[t.startIndex],this.source[t.endIndex]="});"+this.source[t.endIndex];t.end.length&&(this.source[t.endIndex]=t.end+this.source[t.endIndex])}},l.prototype=Object.create(h.prototype),d.getOptions=function(){return{isDefault:!0,code:!0,regexp:!0}},(d.prototype=Object.create(i.prototype)).handleParenthesis=function(e){this.add(this.parser.last=e),this.parser.lastIndex=this.parser.index},d.prototype.addObservable=function(e,t,s){if(s.length){var r=this.source[this.source.length-1];this.source[this.source.length-1]=r.substring(0,r.length-s.length)}var i=!!this.parser.readIf("?"),n=this.parser.skip();n&&this.add(n),"("==this.parser.peek()?s+=this.parseCodeToSource("skipEnclosedContent"):s+=this.parseCodeToSource("readVarName",!0),i?(this.add(this.runtime+"."+this.transpiler.feature("value")+"("+s+")"),t&&t.push(s)):(this.add(s+".value"),e&&e.push(s)),this.parser.last=")",this.parser.lastIndex=this.parser.index},d.prototype.lookBehind=function(){for(var e=this.parser.lastIndex,t=e;0<=t&&/[\s\.a-zA-Z0-9_$]/.test(this.parser.input.charAt(t));)t--;return this.parser.input.substring(t+1,e+1)},d.prototype.next=function(r){switch(r){case"(":this.parentheses.push(!1),this.parser.parentheses.push(this.parser.lastIndex),this.handleParenthesis(r);break;case")":var e=this.parentheses.pop();e&&this.add(e),this.parser.lastParenthesis=this.parser.parentheses.pop(),this.handleParenthesis(r);break;case"@":if("@"==this.parser.peek()){this.parser.index++,this.add(("."!=this.parser.last?this.element+".":"")+"__builder.widgets");var t=this.parser.skipImpl({strings:!1});this.add(t),/[a-zA-Z_$]/.test(this.parser.peek())&&this.add(".")}else{var i=this.parser.skipImpl({strings:!1}),s=this.parser.peek(),n=function(){void 0!==s&&/[a-zA-Z0-9_]/.test(s)?this.add("@"+i):(this.add(this.element),i&&this.add(i))}.bind(this);if(r=this.parser.input.substr(this.parser.index).match(/^(?:((?:\.?[a-zA-Z0-9_$]+)*)(\s*)\()/)){var a=function(e,t,s){this.parser.index+=r[0].length,this.add((e?this.runtime+".":"")+i+t+r[2]+"("+(s||"")),this.parentheses.push(!1)}.bind(this);switch(r[1]){case"subscribe":a(!0,this.transpiler.feature("subscribe"),this.bind+", ");break;case"watch":case"watch.deep":case"watch.deps":case"watch.always":var o=r[1].substr(5);this.parser.index+=r[0].length,this.parser.parseTemplateLiteral=null;var h=this.transpiler.parseCode(this.parser.readExpression());this.transpiler.updateTemplateLiteralParser(),h.observables&&h.observables.length||h.maybeObservables&&h.maybeObservables.length||".deps"==o?this.add(this.runtime+"."+this.transpiler.feature("computedObservable")+o+"(this, "+this.bind+", "+h.toSpreadValue()):this.add(this.runtime+"."+this.transpiler.feature("observable")+o+"("+h.source),this.parentheses.push(!1);break;case"text":case"html":this.parser.index+=r[0].length-1,this.add(this.runtime+"."+this.transpiler.feature(r[1])+"("+this.element+", "+this.bind+", "+this.anchor+", "+this.parseCodeToValue("skipEnclosedContent")+")");break;case"on":a(!0,this.transpiler.feature("on"),"this, "+this.element+", "+this.bind+", ");break;case"widget":a(!0,this.transpiler.feature("widget"));break;case"widgets.add":a(!0,this.transpiler.feature("defineWidget"));break;case"widgets.remove":a(!0,this.transpiler.feature("undefineWidget"));break;case"widgets.has":a(!0,this.transpiler.feature("hasWidget"));break;case"widgets.names":a(!0,this.transpiler.feature("getWidgetsNames"));break;case"render":case"":a(!1,r[1],this.transpiler.slotsRegistry+", "+this.element+", "+this.bind+", "+this.anchor+", ");break;case"slot":a(!1,this.transpiler.slotsRegistry+".add",this.runtime+"."+this.transpiler.feature("createAnchor")+"("+this.element+", "+this.bind+", "+this.anchor+"), ");break;case"animations.add":a(!0,this.transpiler.feature("addAnimation"));break;case"ready":case"quote":a(!0,this.transpiler.feature(r[1]));break;case"rgb":case"rgba":case"hsl":case"hsla":case"darken":case"lighten":case"saturate":case"desaturate":case"grayscale":case"greyscale":case"invert":case"pastel":case"sepia":case"mix":case"contrast":a(!0,this.transpiler.feature("css."+r[1]));break;default:n()}}else n()}break;case"*":if(this.parser.couldStartRegExp())if(this.parser.readIf("*")){var p=this.parser.position;this.parser.parseTemplateLiteral=null;h=this.transpiler.parseCode(this.parser.readSingleExpression(!0));this.transpiler.updateTemplateLiteralParser(),(h.observables&&h.observables.length||h.maybeObservables&&h.maybeObservables.length)&&this.transpiler.warn("The observable syntax `**` cannot be used to create computed observables, use `@watch` instead.",p),this.add(this.runtime+"."+this.transpiler.feature("observable")+"("+h.source+")"),this.parser.last=")",this.parser.lastIndex=this.parser.index}else this.addObservable(this.observables,this.maybeObservables,"");else"."==this.parser.last?this.addObservable(this.observables,this.maybeObservables,this.lookBehind()):(this.add("*"),"*"==this.parser.peek()&&this.add(this.parser.read()),this.parser.last="*");break;case"^":this.parser.couldStartRegExp()?this.addObservable(null,null,""):"."==this.parser.last?this.addObservable(null,null,this.lookBehind()):(this.add("^"),this.parser.last="^")}},f.getOptions=function(){return{comments:!1,strings:!1}},(f.prototype=Object.create(l.prototype)).replaceText=Text.replaceEntities||function(e){return r||(r=document.createElement("textarea")),r.innerHTML=e,r.value},m.getOptions=function(){return{comments:!1,strings:!1,children:!1,tags:["script"]}},(m.prototype=Object.create(c.prototype)).handle=function(){return!!/^\/#?script>/.exec(this.parser.input.substr(this.parser.index))},b.getOptions=function(){return{comments:!0,inlineComments:!1,strings:!0,children:!1}},b.prototype=Object.create(l.prototype),v.getOptions=function(){return{strings:!0,children:!1,tags:["style"]}},(v.prototype=Object.create(h.prototype)).addScope=function(e){var t=this.transpiler.nextVarName();this.add("var "+t+"="+this.runtime+"."+this.transpiler.feature("select")+"("+this.scopes[this.scopes.length-1]+", "+e+");"),this.scopes.push(t)},v.prototype.removeScope=function(){this.scopes.pop()},v.prototype.skip=function(){var e=this.parser.skip();e&&this.add(e)},v.prototype.start=function(){this.add(this.runtime+"."+this.transpiler.feature("compileAndBindStyle")+"(function(){"),this.add("var "+this.scopes[0]+"="+this.runtime+"."+this.transpiler.feature("root")+"();"),this.scoped?this.addScope("'.' + "+this.runtime+".config.prefix + "+this.element+".__builder.runtimeId"):this.scope&&this.addScope(JSON.stringify("."+this.scope))},v.prototype.find=function(){return this.parser.find(["$","<","v","c","l","i","e","f","w","{","}",";"],!1,!1)},v.prototype.lastValue=function(e,t){var s;if(this.current.length){if(this.current[0].text){var r=this.current[0].value,i=pe.trimStart.call(r);this.add(r.substring(0,r.length-i.length)),this.current[0].value=i}if(this.current[this.current.length-1].text){r=this.current[this.current.length-1].value,i=pe.trimEnd.call(r);s=r.substr(i.length),this.current[this.current.length-1].value=i}}e.call(this,this.current.filter(function(e){return!e.text||e.value.length}).map(function(e){return e.text?ce(e.value):(Array.prototype.push.apply(this.observables,e.value.observables),Array.prototype.push.apply(this.maybeObservables,e.value.maybeObservables),t?t(e.value.source):"("+e.value.source+")")}.bind(this)).join(" + ")),s&&this.add(s),this.current=[]},v.prototype.parseImpl=function(e,t,s,r){switch(t){case"{":this.lastValue(function(e){this.addScope(e)}),this.statements.push({selector:!0,observables:[],maybeObservables:[],end:"",parts:[{}]}),this.inExpr=!1;break;case";":for(var i=this.scopes[this.scopes.length-1],n=0;n<this.current.length;n++){var a=this.current[n];if(a.text){var o=a.value.indexOf(":");if(-1!=o){var h,p=this.transpiler;(h=this.current.slice(n+1)).unshift({text:!0,value:a.value.substr(o+1)}),a.value=a.value.substring(0,o),this.current=this.current.slice(0,n+1),this.lastValue(function(e){this.add(i+".value("+e)}),this.add(","),this.current=h,this.lastValue(function(e){this.add(e+");")},function(e){return v.createExpr(e,p)});break}}}h||this.lastValue(function(e){this.add(i+".stat("+e+");")}),this.inExpr=!1;break;default:c.prototype.parseImpl.call(this,e,t,s,r)}},v.prototype.parse=function(e,t){this.inExpr||(this.add(this.parser.skip()),this.inExpr=!0),h.prototype.parse.call(this,e,t)},v.prototype.onStatementStart=function(e){this.inExpr=!1},v.prototype.onStatementEnd=function(e){e.selector?this.removeScope():(Array.prototype.push.apply(this.observables,e.observables),Array.prototype.push.apply(this.maybeObservables,e.maybeObservables)),this.inExpr=!1},v.prototype.addFinalCurrent=function(){for(;this.current.length;)this.add(this.current.shift().value)},v.prototype.end=function(){this.popped.forEach(function(e){e.selector?this.source[e.endIndex-1]="":e.end.length&&(this.source[e.endIndex]=e.end+this.source[e.endIndex])}.bind(this)),this.add("return "+this.scopes[0]+".content}, "+this.element+", "+this.bind+", ["+p(this.observables).join(", ")+"], ["+this.maybeObservables.join(", ")+"])")},v.prototype.actionImpl=function(e){if(this.scoped)return"function(){ this.parentNode.__builder."+e+"Class("+this.runtime+".config.prefix + this.__builder.runtimeId); }"},v.prototype.afterappend=function(){return this.actionImpl("add")},v.prototype.beforeremove=function(){return this.actionImpl("remove")},v.createExprImpl=function(e,t,s){var r=new y(e);function i(){var e=r.skipImpl({strings:!1,comments:!0});e&&(t.computed+=e)}function n(){var e=r.readImpl(/^[+-]{1,2}/,!1);e&&(t.computed+=e,t.op++)}function a(){var e=r.readImpl(/^[+*\/%-]/,!1);if(e)return t.computed+=e,t.op++,!0}for(r.options={comments:!0,strings:!0};!r.eof();){if(i(),n(),"("==r.peek()){t.computed+="(";r.index;if(!v.createExprImpl(r.skipEnclosedContent().slice(1,-1),t,s))return!1;t.computed+=")"}else{var o=r.readSingleExpression(!0);/^[a-zA-Z_$]/.exec(o)?(t.is=!0,t.computed+=t.runtime+"."+s.feature("unit")+"("+t.param+","+o+")"):t.computed+=o}n(),i();var h=a();if(i(),!h&&!r.eof())return!1}return!0},v.createExpr=function(e,t){var s=t.nextVarName(),r={runtime:t.runtime,param:s,computed:"(function("+s+"){return "+t.runtime+"."+t.feature("computeUnit")+"("+s+",",is:!1,op:0};return v.createExprImpl(e,r,t)&&r.is&&r.op&&r.computed+")})({})"||"("+e+")"},g.Internal={Parser:y,SourceParser:n,BreakpointParser:i,TextParser:c,LogicParser:h,JavascriptParser:d,HTMLParser:f,ScriptParser:m,CSSParser:b,SSBParser:v},g.defineMode(["code","javascript","js"],d,!0),g.defineMode(["html"],f),g.defineMode(["script"],m),g.defineMode(["css"],b),g.defineMode(["ssb","style"],v),g.prototype.nextId=function(){return this.count++},g.prototype.nextVarName=function(){for(var e=this.count++%1521,t="";0<e;){var s=(e-1)%39;t=String.fromCharCode(1377+s)+t,e=Math.floor((e-s)/39)}return t},g.prototype.startMode=function(e,t){var s=g.startMode(e,this,this.parser,this.source,t);return this.currentMode={name:le[e].name,parser:s,options:s.options},this.modes.push(this.currentMode),s},g.prototype.endMode=function(){var e=this.modes.pop().parser;return e.end(),this.currentMode=this.modes[this.modes.length-1],this.currentMode&&(this.parser.options=this.currentMode.options),e},g.prototype.parseCode=function(e,t){var s=new y(e,(t||this.parser).position),r=[],i=g.startMode(u,this,s,r);if(i.observables){var n=this;s.parseTemplateLiteral=function(e){var t=n.parseCode(e,s);return Array.prototype.push.apply(i.observables,t.observables),Array.prototype.push.apply(i.maybeObservables,t.maybeObservables),t.source}}for(i.start();s.index<e.length;)i.parse(function(){r.push("<")},function(){});i.end(),r=r.join("");var a=i.observables?p(i.observables):[],o=i.maybeObservables?p(i.maybeObservables):[],h=(n=this,{source:r,observables:a,maybeObservables:o,toValue:function(){return a.length||o.length?1==a.length&&"*"==e.charAt(0)&&r==e.substr(1)+".value"?e.substr(1):n.runtime+"."+n.feature(o.length?"maybeComputedObservable":"computedObservable")+"(this, "+n.bind+", "+h.toSpreadValue()+")":r},toSpreadValue:function(){return"["+a.join(", ")+"], function(){return "+r+"}, ["+o.join(", ")+"]"}});return h},g.prototype.parseTemplateLiteral=function(e,t){return this.parseCode(e,t).source},g.prototype.updateTemplateLiteralParser=function(){this.parser.parseTemplateLiteral=this.parseTemplateLiteral.bind(this)},g.prototype.wrapFunction=function(e,t){return"{"==e.charAt(0)&&"}"==e.charAt(e.length-1)?"function("+Array.prototype.slice.call(arguments,2).join(", ")+"){"+(t?"return ":"")+e.substring(1,e.length-1)+"}":e},g.prototype.addSemicolon=function(){if(this.currentMode.options.code){var e=this.parser.skip(),t=this.parser.peek();";"!=t&&":"!=t&&","!=t&&"."!=t&&")"!=t&&"]"!=t&&"}"!=t&&"&"!=t&&"|"!=t&&this.source.push(";"),e&&this.source.push(e)}else this.source.push(";")},g.prototype.close=function(e){this.parser.eof();if(void 0!==e){var t=this.tags.pop();t.tagName&&t.tagName!=e&&this.warn("Tag `"+t.tagName+"` is not closed properly (used `</"+e+">` instead of `</"+t.tagName+">`).",t.position),t.mode&&this.endMode(),this.inheritance.pop(),this.level--}this.closing.length&&(this.source.push(this.closing.pop()),this.addSemicolon())},g.prototype.open=function(){if("/"==this.parser.peek()){this.parser.index++;var e=this.parser.find([">"],!0,!1);this.close(e.pre)}else if("!"==this.parser.peek()){this.parser.index++;var t=this.parser.input.substr(this.parser.index);if(pe.startsWith.call(t,"COMMENT "))this.parser.index+=8,this.source.push("/*"+this.parser.findSequence(">",!0).slice(0,-1)+"*/");else{var s=["runtime","element","bind","anchor"],r=!1;for(var i in s)if(pe.startsWith.call(t,s[i].toUpperCase()+">")){this.parser.index+=s[i].length+1,this.source.push(this[s[i]]),this.addSemicolon(),r=!0;break}r||(this.parser.expect("-"),this.parser.expect("-"),this.source.push(this.runtime+"."+this.feature("comment")+"("+this.element+", "+this.bind+", "+this.anchor+", "+ce(this.parser.findSequence("--\x3e",!0).slice(0,-3))+")"),this.addSemicolon())}}else{if(!1===this.currentMode.options.children&&"#"!=this.parser.peek())throw new Error("Mode "+this.currentMode.name+" cannot have children");var n,a=this.parser.position,o=this.parser;function h(e){var t=o.skipImpl({comments:!0,strings:!1});t,e&&(n=t)}this.source.length;var p,u,c,l,d,f=!0,m=!0,b=!0,v=this.element,y=this.element,g={},x=[],E=[],k=void 0,O=null,S=[],I=[],A=[],w=!1,T=!1,_="",P=!1;this.updateTemplateLiteralParser(),(c=this.parser.readQueryExpr())?(c=this.parseCode(c).source,P=!!this.parser.readIf("+"),this.parser.readIf("*")&&(u="document",P||(P=!!this.parser.readIf("+"))),f=b=!1):(T=!!this.parser.readIf("?"),(_=this.parser.readComputedExpr())?(_=this.parseCode(_).source,w=!0):(l=_=this.parser.readTagName(!0),0<(q=_.indexOf(":"))&&(d=_.substr(q+1),_=_.substring(0,q),f=b=!1)));h(!0);for(var C=!1;!this.parser.eof()&&">"!=(C=this.parser.peek())&&"/"!=C;){if(/[\n\t ]/.test(n)||this.parser.error("Space is required between attribute names."),this.updateTemplateLiteralParser(),"."==C){this.parser.index++,this.parser.expect("."),this.parser.expect(".");var N=this.parser.readSingleExpression(!1);N||this.parser.error("Could not find a valid expression."),E.push(N),h(!0)}else{var L=!1,R='""',j=[this.parseAttributeName(!0,!1)];if(this.parser.readIf("{")){var M=[];do{for(var i in h(),j)M.push(this.parseAttributeName(!0,!0,j[i]));h()}while(","==(C=this.parser.read()));"}"!=C&&this.parser.error("Expected '}' after interpolated attributes list."),j=M;var V=this.parseAttributeName(!1,!1);V.parts.length&&j.forEach(function(t){V.computed&&(t.computed=!0),V.parts.forEach(function(e){t.parts.push(pe.assign({},e))})})}for(var i in j){!1===(Y=j[i]).prefix&&(Y.prefix=""),this.compileAttributeParts(Y)}if(h(!0),"="==this.parser.peek()){this.parser.index++,h(),this.parser.parseTemplateLiteral=null;var B=j[0].prefix;for(i=1;i<j.length;i++)if(j[i].prefix!=B){B=null;break}var $=j.every(function(e){return"+"!=e.prefix&&"-"!=e.prefix}),D=1==j.length?j[0].name:"";"#"==(R=this.parser.readAttributeValue()).charAt(0)&&(R=this.runtime+".functions."+R.substr(1)+"()"),j.every(function(e){return"@"==e.prefix||"+"==e.prefix})?R=this.wrapFunction(R,!1,"event"):1==j.length&&":"==j[0].prefix&&("change"==D?R=this.wrapFunction(R,!0,"oldValue","newValue"):"condition"==D||"if"==D?R=this.wrapFunction(R,!0):"cleanup"==D&&(R=this.wrapFunction(R,!1)));var U=this.parseCode(R);R=$?U.toValue():U.source,h(!0)}for(var i in j){var Y;switch((Y=j[i]).value=R,Y.prefix){case"#":Y.computed&&this.parser.error("Mode attributes cannot be computed."),k=de[Y.name];break;case":":if(Y.computed&&this.parser.error("Compile-time attributes cannot be computed."),g.hasOwnProperty(Y.name))if(g[Y.name]instanceof Array)g[Y.name].push(R);else(g[Y.name]=[g[Y.name],R]).toString=function(){return"["+this.join(", ")+"]"};else g[Y.name]=R;break;case"*":L=!1;var F,q,W=Y.parts[0];switch(W&&!W.computed||this.parser.error("First part of semi compile-time attributes cannot be computed."),-1==(q=W.name.indexOf(":"))&&(q=W.name.length),D=W.name.substring(0,q)){case"next":F=!0;case"prev":Y.prefix="",5==W.name.length?Y.parts.shift():W.name=W.name.substr(5),Y.value=this.runtime+"."+this.feature((F?"next":"prev")+"Id")+"()",'""'!=R&&(Y.value=R+" + "+Y.value),L=!0;break;case"io":case"in":case"out":var z=W.name.substring(0,q);W.name=W.name.substr(q+1),W.name.length||Y.parts.shift(),this.compileAttributeParts(Y),I.push({type:z,name:this.stringifyAttribute(Y),value:Y.value});break;case"number":W.name+=":number";case"checkbox":case"color":case"date":case"email":case"file":case"hidden":case"password":case"radio":case"range":case"text":case"time":x.push({prefix:"",name:"type",value:'"'+D+'"'});case"form":case"value":q==W.name.length-1?Y.parts.shift():W.name=W.name.substr(q),this.compileAttributeParts(Y),A.push([this.stringifyAttribute(Y),Y.value]);break;default:this.parser.error("Unknown semi compile-time attribute '"+D+"'.")}if(!L)break;this.compileAttributeParts(Y);default:x.push(Y)}}}C=!1}C||this.parser.errorAt(a,"Tag was not closed."),o.index++,g.namespace&&g.namespace;var Z=function(){var t=++this.level,i={},n={};this.inheritance.filter(function(e){return e&&(!e.level||-1!=e.level.indexOf(t))&&(!e.whitelist||-1!=e.whitelist.indexOf(_))}).forEach(function(e){for(var t in e.data)n[t]=(n[t]||[]).concat(e.data[t])});var e=!(!n.args&&!x.length);return w&&(i.widget=!1),g.namespace?i.namespace=g.namespace:g.xhtml?i.namespace=this.runtime+".NS_XHTML":g.svg?i.namespace=this.runtime+".NS_SVG":g.mathml?i.namespace=this.runtime+".NS_MATHML":g.xul?i.namespace=this.runtime+".NS_XUL":g.xbl?i.namespace=this.runtime+".NS_XBL":w||("svg"==_?i.namespace=this.runtime+".NS_SVG":"mathml"==_&&(i.namespace=this.runtime+".NS_MATHML")),e&&(i.args=x.map(function(e){return this.runtime+"."+this.feature("attr")+"("+{"":ue.BUILDER_TYPE_NONE,"@":ue.BUILDER_TYPE_PROP,"~":ue.BUILDER_TYPE_CONCAT,"+":ue.BUILDER_TYPE_ON,$:ue.BUILDER_TYPE_WIDGET,$$:ue.BUILDER_TYPE_EXTEND_WIDGET}[e.prefix]+", "+(e.computed?e.name:'"'+(e.name||"")+'"')+('""'!=e.value||e.optional?", "+e.value:"")+(e.optional?", 1":"")+")"}.bind(this)).join(", ")),E.length&&(i.spread=E.join(", ")),I.length&&(i.transitions=I.map(function(e){return'["'+e.type+'", '+e.name+", "+('""'==e.value?"{}":e.value)+"]"}).join(", ")),Object.defineProperty(i,"toString",{enumerable:!1,value:function(){var r=[];return["widget","namespace"].forEach(function(e){if(i.hasOwnProperty(e))r.push(e+":"+i[e]);else{var t=n[e];t&&r.push(e+":"+t[t.length-1])}}),["args","spread","transitions"].forEach(function(e){var t=n[e],s=i[e];(t||s)&&r.push(e+":["+(t||[]).concat(s||[]).join(", ")+"]")}),"{"+r.join(", ")+"}"}}),i}.call(this);if(g.root?v=v+".getRootNode({composed: "+(g.composed||"false")+"})":g.head?v="document.head":g.body?v="document.body":g.parent&&(v=g.parent),'""'!=v&&!g.orphan||(b=!(v="null")),!w)if(":"==_.charAt(0)){D=_.substr(1);if(this.options.aliases&&this.options.aliases.hasOwnProperty(D)){var H=this.options.aliases[D];_=H.tagName,H.hasOwnProperty("parent")&&(v=H.parent),H.hasOwnProperty("element")&&(y=H.element),H.hasOwnProperty("create")&&(f=H.create),H.hasOwnProperty("update")&&(m=H.update),H.hasOwnProperty("append")&&(b=H.append),H.hasOwnProperty("mode")&&(k=H.mode)}else switch(D){case"root":y=y+".getRootNode({composed: "+(g.composed||"false")+"})",f=b=!1;break;case"html":f=b=!(y="document.documentElement");break;case"head":case"body":y="document."+D,f=b=!1;break;case"fragment":p=y,f=!(y="document.createDocumentFragment()");break;case"shadow":y=v+".attachShadow({mode: "+(g.mode||'"open"')+"})",f=m=b=!1;break;case"anchor":_=":bind",f=m=b=!(g.to="[]");break;case"inherit":var K=O={data:Z};if(g.level||g.depth){if(g.level?g.level instanceof Array?K.level=g.level.map(function(e){return parseInt(e)}):K.level=[parseInt(g.level)]:K.level=[1],g.depth){var G=parseInt(g.depth);isNaN(G)&&this.parser.error("Depth is not a valid number.");var J=[];for(i=0;i<G;i++)K.level.forEach(function(e){J.push(e+i)});K.level=J}for(i=0;i<K.level.length;i++)K.level[i]+=this.level}g.whitelist&&(K.whitelist=g.whitelist instanceof Array?g.whitelist:[g.whitelist],K.whitelist=K.whitelist.map(function(e){return JSON.parse(e)})),f=m=b=!1;break;case"scope":case"bind":case"bind-if":case"bind-each":default:f=m=b=!1}}else"#"==_.charAt(0)?void 0!==(k=de[_.substr(1)])&&(f=m=b=!1):"@"==_?f=b=!1:_&&(this.tagNames.hasOwnProperty(_)?this.tagNames[_]++:this.tagNames[_]=1);if(!O&&Z.namespace&&(O={data:{namespace:Z.namespace}}),void 0===k)for(i=0;i<le.length;i++){var X=le[i].parser.getOptions().tags;if(X&&-1!=X.indexOf(_)){k=i;break}}if(void 0!==k){var Q={};for(var ee in g)try{R=JSON.parse(g[ee]);Q[ee]=""===R||R}catch(e){}this.startMode(k,Q)}if("#"!=_.charAt(0)){(!w&&":debug"==_||g.debug)&&(this.source.push("if("+this.runtime+".debug){"),S.unshift("}")),g.ref&&this.source.push(g.ref+" = "),c&&(g["query-head"]?u="document.head":g["query-body"]&&(u="document.body"),this.source.push(this.runtime+"."+this.feature("query")+"(this, "+(g.query||u||v)+", "+v+", "+c+", "+P+", function("+this.element+", "+this.parentElement+"){"),(g.adopt||g.clone)&&(v=this.parentElement,m=b=!(f=!1)),S.unshift("})")),g.unique&&(this.source.push(this.runtime+"."+this.feature("unique")+"(this, "+this.nextId()+", function(){return "),S.unshift("})"));var te=[],se=[],re="",ie=!0,ne=!1;if(":bind"==_&&(this.source.push(this.runtime+"."+this.feature("bind")+"("+["this",v,this.bind,this.anchor,g.to].join(", ")+", function("+[this.element,this.bind,this.anchor,g.as||this.value].join(", ")+"){"),S.unshift("})")),d)te.push([this.feature("updateSlot"),Z,this.slots,'"'+_+'"','"'+d+'"',"function("+this.element+", "+this.anchor+"){"]),ie=b=!1,re+="}";else if(g.clone)te.push([this.feature("clone"),Z]);else if(T)te.push([this.feature("createOrUpdate"),y,w?_:'"'+_+'"',Z]);else if(f)te.push([this.feature("create"),w?_:'"'+_+'"',Z]);else if(m){var ae=Z.toString();2<ae.length&&te.push([this.feature("update"),ae])}if(g.clear&&te.push([this.feature("clear")]),A.length&&se.push([this.feature("forms"),A.map(function(e){return"["+e.join(", ")+"]"}).join(", ")]),b){b=[this.feature("append"),v,this.anchor].concat(void 0!==k?[this.currentMode.parser.afterappend()||0,this.currentMode.parser.beforeremove()||0]:[]);T&&(b[0]="["+(p||y)+' ? "'+this.feature("noop")+'" : "append"]'),se.push(b)}"/"==C&&(this.parser.expect(">"),ie=!(ne=!0)),te&&(ie||g.slot)&&(te.push([this.feature("body"),this.slots,"function("+this.element+", "+this.anchor+", "+this.slots+"){"]),re+="}");var oe=this.runtime;function he(e){return", ["+oe+("["!=e[0].charAt(0)?".":"")+e.join(", ")+"]"}te.length||se.length?(this.source.push(this.runtime+"(this, "+y+", "+this.bind+", "+this.anchor+te.map(he).join("").slice(0,-1)),S.unshift((te.length?"]":"")+se.map(he).join("")+")")):this.source.push(v),S.unshift(re)}if(g.slot){L=function(e){this.source.push(this.slotsRegistry+".add(null, "+e+", "+this.element+");")}.bind(this);g.slot instanceof Array?g.slot.forEach(L):L(g.slot)}S=S.join(""),ne?(void 0!==k&&this.endMode(),this.source.push(S),this.addSemicolon(),this.level--):(this.inheritance.push(O),this.closing.push(S),this.tags.push({tagName:l,position:a,mode:void 0!==k}),void 0!==k&&this.currentMode.parser.start())}this.parser.last=void 0},g.prototype.parseAttributeName=function(e,t,s){var r;if(s?((r=pe.assign({},s)).parts=[],s.parts.forEach(function(e){r.parts.push(pe.assign({},e))})):r={prefix:!1,computed:!1,parts:[]},e){this.parser.readIf("?")&&(r.optional=!0);var i=this.parser.readAttributePrefix();!1!==i&&(r.prefix=i),":"==r.prefix&&r.optional&&this.parser.error("Compile-time attributes cannot be optional."),"#"==r.prefix&&r.optional&&this.parser.error("Mode attributes cannot be optional.")}for(var n=t&&"$"!=r.prefix;;){var a={};if(a.name=this.parser.readComputedExpr())r.computed=a.computed=!0,"["==a.name.charAt(0)&&"]"==a.name.charAt(a.name.length-1)?(a.name=a.name.slice(1,-1),a.name=this.runtime+".config.shortcut"+("["==a.name.charAt(0)?"":".")+a.name):a.name=this.parseCode(a.name).source;else if(!(a.name=this.parser.readAttributeName(n)))break;r.parts.push(a),n=!1}return r},g.prototype.compileAttributeParts=function(e){if(e.computed){var t=[];e.parts.forEach(function(e){e.computed?t.push("("+e.name+")"):t.push(JSON.stringify(e.name))}),e.name=t.join("+")}else e.name=e.parts.map(function(e){return e.name}).join("")},g.prototype.stringifyAttribute=function(e){return e.computed?e.name:'"'+e.name+'"'},g.prototype.feature=function(e){return this.features[e]=!0,e},g.prototype.nextVar=function(){return String.fromCharCode(1377+this.count++%39)},g.prototype.warn=function(e,t){t||(t=this.parser.position),this.warnings.push("Line "+(t.line+1)+", Column "+t.column+": "+e)},g.prototype.transpile=function(e){var t=o();this.parser=new y(e),this.count=function(e){for(var t=0,s=0;s<e.length;s++)t+=16777619*e.charCodeAt(s);return t}(this.options.namespace+"")%1e5,this.runtime=this.nextVar(),this.element=this.nextVar(),this.parentElement=this.nextVar(),this.bind=this.nextVar(),this.anchor=this.nextVar(),this.value=this.nextVar(),this.index=this.nextVar(),this.array=this.nextVar(),this.slots=this.nextVar(),this.slotsRegistry=this.nextVar(),this.tagNames={};var s=this.features={};this.warnings=[],this.before="/*! Transpiled"+(this.options.filename?" from "+this.options.filename:"")+" using Sactory v"+("undefined"!=typeof Sactory?Sactory.VERSION:version.version)+". Do not edit manually. */!function(a){if(typeof define=='function'&&define.amd){define(['sactory'], a)}else{a(Sactory)}}(function("+this.runtime+", "+this.element+", "+this.bind+", "+this.anchor+", "+this.slots+"){",this.source=[],this.options.scope&&(this.before+=this.element+"="+this.options.scope+";"),this.tags=[],this.inheritance=[],this.closing=[],this.modes=[],this.currentMode,this.level=0,this.startMode(u,{}).start();for(var r=g.prototype.open.bind(this),i=g.prototype.close.bind(this);!this.parser.eof();)this.updateTemplateLiteralParser(),this.currentMode.parser.parse(r,i);this.endMode(),this.after="})";var n=this.source.join("");return Object.keys(s).forEach(function t(e){x.hasOwnProperty(e)&&x[e].forEach(function(e){s[e]=!0,t(e)})}),{time:o()-t,variables:{runtime:this.runtime,element:this.element,bind:this.bind,anchor:this.anchor,value:this.value,index:this.index,array:this.array,slots:this.slots,slotsRegistry:this.slotsRegistry},scope:this.options.scope,sequence:this.count,tags:this.tagNames,features:Object.keys(s),warnings:this.warnings,source:{before:this.before,after:this.after,all:this.before+n+this.after,contentOnly:n}}};var x={create:["update"],createOrUpdate:["create","update"],clone:["update"],updateSlot:["update"],appendAnchor:["update"],mixin:["append","html"],comment:["append"],bind:["createAnchor"],bindIf:["bind"],bindEach:["bind"],maybeComputedObservable:["filterObservables","computedObservable"],convertStyle:["compileStyle"],compileAndBindStyle:["convertStyle"]};if("object"==typeof window){var E=0;function k(){Array.prototype.forEach.call(document.querySelectorAll("script[type='text/x-builder'], style[type='text/x-builder']"),function(e){var t,s=E+++"";"STYLE"==e.tagName&&(e.removeAttribute("type"),t=e.outerHTML,e.setAttribute("type","text/x-builder")),e.dataset.sactoryFrom=s,e.dataset.to="[data-sactory-to='"+s+"']";var r=document.createElement("script");r.dataset.sactoryTo=s,r.dataset.from="[data-sactory-from='"+s+"']";var i=new g({namespace:s}).transpile(t||e.textContent);i.warnings.forEach(function(e){console.warn(e)}),r.textContent=i.source.all,document.head.appendChild(r)})}"complete"==document.readyState?k():window.addEventListener("load",k)}return g});