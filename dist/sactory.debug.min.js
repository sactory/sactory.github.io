"use strict";var _slicedToArray=function(){function e(e,t){var n=[],r=!0,o=!1,a=void 0;try{for(var l,s=e[Symbol.iterator]();!(r=(l=s.next()).done)&&(n.push(l.value),!(t&&n.length===t));r=!0);}catch(e){o=!0,a=e}finally{try{!r&&s["return"]&&s["return"]()}finally{if(o)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toArray(e){return Array.isArray(e)?e:Array.from(e)}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}!function(e){"function"==typeof define&&define.amd?define(e):window.Sactory=e()}(function(){function e(e){for(var t,n="",r=0;r<e.length;r++)t=e.charCodeAt(r),65<=t&&90>=t?(0<r&&(n+="-"),n+=String.fromCharCode(t+32)):n+=e.charAt(r);return n}function t(e){for(var t="",n=0;n<e.length;n++)if("-"==e.charAt(n)){var r=e.charCodeAt(++n);t+=97<=r&&122>=r?String.fromCharCode(r-32):e.charAt(n)}else t+=e.charAt(n);return t}function Bind(e,t){this.parent=e,this.createdBy=t,this.children=[],this.subscriptions=[],this.elements=[],this.rollbacks=[]}function Sactory(e){this.element=e,this.hasComplexStyle=!1,this.styles=[],this.events={},this.element.classList||(this.addClassName=this.addClassNamePolyfill.bind(this),this.removeClassName=this.removeClassNamePolyfill.bind(this))}function n(e){this.init=this.count=e,this.bind=0,this.observable=0,this.subscription=0}function r(e){for(var t=Sactory.newChainContext(e),n=arguments.length,r=Array(1<n?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];return r.forEach(function(e){var n=_toArray(e),r=n[0],o=n.slice(1);return r.call.apply(r,[null,t].concat(_toConsumableArray(o)))}),t.element}function o(e){Object.defineProperty(e.prototype,"~builder",{configurable:!0,get:function e(){return this["~builderInstance"]||(this["~builderInstance"]=new Sactory(this))}})}function l(e){for(var t in this.args=e,this.length=e.length,e)this[t]=e[t]}function Subscription(e,t,n,r){Object.defineProperty(this,"id",{value:k.nextSubscription()}),this.observed=e,this.observer=t,this.callback=n,this.type=r,this.disposed=!1}function Observable(e){Object.defineProperty(this,"id",{value:k.nextObservable()}),this._subscriptions=[],this._value=this.wrapValue(e)}function ComputedObservable(e,t){Observable.call(this),this.context=e,this.fun=t,this.deps=this.ndeps={},this.tracker=new s(this),this._value=this.wrapValue(t(this.tracker)),this.ndeps={}}function s(e){this.observable=e,this.context=e.context}function Builder(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],o=!!(4<arguments.length&&void 0!==arguments[4])&&arguments[4];this.root=e,this.sroot=t,this.tree=n,this.selectors=r,this.absolute=o}function Color(e){this.type=e}function RGBColor(e,t,n,r){Color.call(this,"rgb"),this.r=e,this.g=t,this.b=n,this.a="number"==typeof r?r:1}function HSLColor(e,t,n,r){Color.call(this,"hsl"),this.h=e,this.s=t,this.l=n,this.a="number"==typeof r?r:1}function p(e){if("#"==e.charAt(0))return RGBColor.fromHexString(e.substr(1));var t=e.indexOf("(");if(0<t){var n=e.substring(0,t),r=e.slice(t+1,-1).split(","),o=_slicedToArray(r,4),l=o[0],a=o[1],s=o[2],p=o[3],i=p?+p:void 0;switch(n){case"rgb":case"rgba":return new RGBColor(l/255,a/255,s/255,i);case"hsl":case"hsla":return new HSLColor(l/360,L(a),L(s),i);default:throw new Error("Unknown color format '"+n+"'");}}else return W(e)}function d(e,t){return new e(Math.random(),Math.random(),Math.random(),t?Math.random():void 0)}function c(e,t){return function(n,r,o){return n=e(n),n[t]=Math.min(1,Math.max(0,function(e,t){return"sum"===r||"add"===r?e+ +t:"subtract"===r||"remove"===r?e-t:"multiply"===r?e*t:"divide"===r?e/t:+r}(n[t],o))),n}}function m(t,n,r){if(n)r(t,n);else if(t&&t.name)r(e(t.name),t);else throw new Error("Invalid or missing name widget.")}function Widget(e){this.attrs=e}function u(e){this.parent=e,this.widgets={main:null,named:{}},this.slots={},e&&(this.targetSlots=e.targetSlots),this.main=null}function y(e,t,n){Object.defineProperty(Sactory.widgets,e,{value:t}),n&&Sactory.addWidget(e,t,!1)}function h(e,t,n){var r=n.element,o=n.bind;if("object"==("undefined"==typeof e?"undefined":_typeof(e))&&!Sactory.isObservable(e))for(var a in e)r["~builder"].classNameIf(a,e[a],o);else r["~builder"].className(e,o)}function b(e,t,n){var r=n.element;for(var o in e){var a=e[o];r.setAttribute(o,!0===a?$:a+$)}}function g(e,t,n,r){var o=e["~builder"],a=e.ownerDocument,l=a["~hidden"];if(!l){l=a["~hidden"]=k.nextPrefix();var s=a.createElement("style");s.textContent="."+l+"{display:none!important;}",a.head.appendChild(s)}var p=function(e){!!e^n?o.addClass(l):o.removeClass(l)};Sactory.isObservable(t)?o.observe(r,t,p):p(t)}var f=function(){return Object.toString().replace(/Object/,"Sactory").replace(/native/,"sactory")};Sactory.toString=f.toString=f,Object.defineProperty(Sactory,"VERSION",{value:"0.145.2"}),Object.defineProperty(Sactory,"BUILT",{value:"2019-10-01T15:59:49.494Z"});var v={startsWith:String.prototype.startsWith||function(e,t){return t=!t||0>t?0:+t,this.substring(t,t+e.length)===e},endsWith:String.prototype.endsWith||function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e},trimStart:String.prototype.trimStart||function(){return this.replace(/^[\s\uFEFF\xA0]+/g,"")},trimEnd:String.prototype.trimEnd||function(){return this.replace(/[\s\uFEFF\xA0]+$/g,"")},padStart:String.prototype.padStart||function(e,t){for(var n=this+"";n.length<e;)n=t+n;return ret},assign:Object.assign||function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.forEach(function(t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}),e},trunc:Math.trunc||function(e){return e-e%1},find:Array.prototype.find||function(e){for(var t,n=0;n<this.length;n++)if(t=this[n],e(t,n,this))return t}},E={},w=function(e,t){return Object.defineProperty(E,e,{value:t})};w("NORMAL",0),w("INTERPOLATED",1),w("SPREAD",2),w("NONE",0),w("PROP",1),w("STYLE",2),w("EVENT",3),w("WIDGET",4),w("UPDATE_WIDGET",5),w("EXTEND_WIDGET",6);var S="object"==("undefined"==typeof window?"undefined":_typeof(window))&&-1!=window.navigator.platform.indexOf("Mac"),_="object"==("undefined"==typeof window?"undefined":_typeof(window))&&(-1!=window.navigator.platform.indexOf("MSIE ")||-1!=window.navigator.userAgent.indexOf("Trident/")),a=S?"meta":"ctrl";Sactory.config={mac:S,ie:_,prefix:"sa",shortcut:{cmd:a,save:"keydown:"+a+":key-code.83",copy:"keydown:"+a+":key-code.67",cut:"keydown:"+a+":key-code.88",paste:"keydown:"+a+":key-code.86",print:"keydown:"+a+":key-code.80",undo:"keydown:"+a+":key-code.90",redo:"keydown:"+a+":key-code.89",find:"keydown:"+a+":key-code.70",select:"keydown:"+a+":key-code.65",left:"key-code.37",up:"key-code.38",right:"key-code.39",down:"key-code.40"},event:{aliases:{space:" ",ctrl:"control",dot:".",comma:",",colon:":",semicolon:";",esc:"escape"}}};for(var B=65;90>=B;B++)Sactory.config.shortcut["ctrl-"+String.fromCharCode(B+32)]="keydown:"+a+":key-code."+B;Sactory.config.s=Sactory.config.shortcut,Bind.prototype.fork=function(e){var t=new Bind(this,e);return this.children.push(t),t},Bind.prototype.rollback=function(){this.subscriptions.length&&(this.subscriptions.forEach(function(e){return e.dispose()}),this.subscriptions=[]),this.elements.length&&(this.elements.forEach(function(e){e.parentNode&&e.parentNode.removeChild(e)}),this.elements=[]),this.rollbacks.length&&(this.rollbacks.forEach(function(e){return e()}),this.rollbacks=[]),this.children.length&&(this.children.forEach(function(e){return e.rollback()}),this.children=[])},Bind.prototype.subscribe=function(e){this.subscriptions.push(e)},Bind.prototype.appendChild=function(e){this.elements.push(e)},Bind.prototype.addRollback=function(e){this.rollbacks.push(e)};var C=new Bind(null,Sactory);Object.defineProperty(Sactory,"bindFactory",{get:function e(){return C}}),Sactory.anchor=function(e){var t=e.element,n=e.bind,r=e.anchor,o=document.createTextNode("");return Object.defineProperty(o,"nodeType",{value:Node.ANCHOR_NODE}),Object.defineProperty(o,"nodeName",{value:"#anchor"}),r?t.insertBefore(o,r):t.appendChild(o),n&&n.appendChild(o),o},Sactory.comment=function(e,t){var n=e.element,r=e.bind,o=e.anchor,a=(e.document||document).createComment(Sactory.isObservable(t)?function(){return t.subscribe(e,function(e){return a.textContent=e}),t.value}():t);return n&&(o?n.insertBefore(a,o):n.appendChild(a),r&&r.appendChild(a)),a},Sactory.bindFlow=function(e,t){var n=Sactory.coff(e,t),r=(e.bind||C).fork("bind"),o=e.element&&Sactory.anchor(e),a=function(t){return t(Sactory.newBindContext(e,r,o))};n.subscribe(e,function(e){r.rollback(),a(e)}),a(n.value)},Sactory.bindFlowIfElse=function(e,t){for(var n=arguments.length,r=Array(2<n?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];var a=Sactory.coff(e,t),l=(e.bind||C).fork("bindIfElse"),s=e.element&&Sactory.anchor(e),p=function(t){-1!=t&&r[t](Sactory.newBindContext(e,l,s))};a.subscribe(e,function(e){l.rollback(),p(e)}),p(a.value)},Sactory.bindFlowEach=function(e,t,n){function r(t,r,o,a,l,s){(r.anchor=o)&&r.appendChild(o),n(Sactory.newBindContext(e,r,o),a,l,s),c[t](r)}function o(e){e.rollback()}function a(){p.value.forEach(function(e,t,n){r("push",new Bind(d,"bindEach."+t),m(s),e,t,n)})}var l,s,p=Sactory.coff(e,t),d=(e.bind||C).fork("bindEach");e.element&&(l=Sactory.anchor(e),s=Sactory.anchor(e));var c=d.children,m=function(t){return e.element?Sactory.anchor({element:e.element,anchor:t}):null};p.subscribe({bind:d},function(t,p,i,u){switch(i){case Sactory.OUT_ARRAY_SET:var y=_slicedToArray(u,2),h=y[0],b=y[1],g=c[h];g&&(g.anchor&&g.bind.elements.shift(),g.bind.rollback(),g.anchor&&g.bind.appendChild(g.anchor),n(Sactory.newBindContext(e,g,g.anchor),b,h,t));break;case Sactory.OUT_ARRAY_PUSH:Array.prototype.forEach.call(u,function(e,n){r("push",new Bind(d),m(s),e,t.length-u.length+n,t)});break;case Sactory.OUT_ARRAY_POP:var f=c.pop();f&&o(f);break;case Sactory.OUT_ARRAY_UNSHIFT:Array.prototype.forEach.call(u,function(e){r("unshift",new Bind(d,"bindEach.unshift"),m(l.nextSibling),e,0,t)});break;case Sactory.OUT_ARRAY_SHIFT:var v=c.shift();v&&o(v);break;case Sactory.OUT_ARRAY_SPLICE:var E=u[0],w=E+(u[1]||0)-1,S=c[w],_=S&&S.anchor&&S.anchor.nextSibling||s,C=Array.prototype.slice.call(u,2).map(function(e){var t=new Bind(d,"bindEach.splice");return t.value=e,t});c.splice.apply(c,[u[0],u[1]].concat(_toConsumableArray(C))).forEach(function(e){e.rollback()}),C.forEach(function(r,o){_&&(r.anchor=m(_),r.appendChild(r.anchor)),n(Sactory.newBindContext(e,r,r.anchor),r.value,o+E,t)});break;default:c.forEach(o),c.length=0,a();}}),a()},Sactory.bindTo=function(e,t,n){var r=(e.bind||C).fork("bindTo"),o=e.element&&Sactory.anchor(e),a=function(){return n(Sactory.newBindContext(e,r,o),t)};t.forEach(function(t){return t.subscribe(e,function(){r.rollback(),a()})}),a()},Sactory.unbindTo=function(e,t,n){n(Sactory.newContext(e,{top:!1,bind:void 0}))};var N=function(e){return function(t,n,r){"function"==typeof n?(r=n,n=[]):!Array.isArray(n)&&(n=[n]),e(t,n,r)}};if(Sactory.$$bind=N(Sactory.bindTo),Sactory.$$unbind=N(Sactory.unbindTo),Sactory.$$rollback=function(e,t){e.bind&&e.bind.addRollback(t)},Sactory.prototype.widgets={},Sactory.prototype.widget=null,Sactory.prototype.observe=function(e,t,n,r){var o=t.subscribe({bind:e},n,r);return n(t.value),o},Sactory.prototype.attr=function(e,t,n){var r=this;Sactory.isObservable(t)?this.observe(n,t,function(t){return r.element.setAttribute(e,t)}):this.element.setAttribute(e,t)},Sactory.prototype.prop=function(e,t,n,r){var o=this;Sactory.isObservable(t)?this.observe(n,t,function(t){return o.element[e]=t},r):this.element[e]=t},Sactory.prototype.complexStyle=function(t,n,r){var o=this;if(this.element.style.length){var a=Array.prototype.map.call(this.element.style,function(e){return{name:e,value:o.element.style[e]}});a.length&&this.styleImpl(a,r),this.element.removeAttribute("style"),this.styles.forEach(function(e){var t=e.name,n=e.value,r=e.subscription,a=e.bind;r.dispose(),o.styleImpl([{name:t,value:n}],a)})}this.hasComplexStyle=!0;var l,s=document.createElement("style"),p=k.nextPrefix(),i=t.indexOf(".");if(-1==i)l=function(e){return"."+p+t+"{"+e+"}"};else{var d=e(t.substr(i+1));t=t.substring(0,i),"!"==d.charAt(0)?(d=d.substr(1),l=function(e){return"."+p+t+"{"+d+":"+e+" !important;}"}):l=function(e){return"."+p+t+"{"+d+":"+e+";}"}}Sactory.isObservable(n)?this.observe(r,n,function(e){return s.textContent=l(e)}):s.textContent=l(n),this.className(p),document.head.appendChild(s)},Sactory.prototype.style=function(e,t,n){var r=this;if(this.hasComplexStyle)!1===t?this.styleImpl([{name:e,value:"0"},{name:e,value:"none"}],n):this.styleImpl([{name:e,value:t}],n);else{var o=e,a=function(e){return e},l=function(e){return r.element.style[o]=a(e)};if("!"==e.charAt(0)&&(o=e.substr(1),a=function(e){return e+" !important"}),Sactory.isObservable(t)){var s=this.observe(n,t,l);this.styles.push({name:e,value:t,subscription:s,bind:n})}else!1===t?(l("0"),l("none")):l(t)}},Sactory.prototype.styleImpl=function(t){t.forEach(function(t){var n=e(t.name);"!"==n.charAt(0)?(n=n.substr(1),t.toString=function(){return n+":"+t.value+" !important;"}):t.toString=function(){return n+":"+t.value+";"}});var n=document.createElement("style"),r=k.nextPrefix(),o=function(){return n.textContent="."+r+"{"+t.join("")+"}"};t.forEach(function(e){var t=e.value,n=e.bind;Sactory.isObservable(t)&&t.subscribe({bind:n},o)}),o(),this.className(r),document.head.appendChild(n)},Sactory.prototype.text=function(e,t){var n=t.top,r=t.bind,o=t.anchor,a=t.document,l=void 0;Sactory.isObservable(e)?(l=a.createTextNode(""),this.observe(r,e,function(e){l.textContent=e+"",l.observed=!0})):l=a.createTextNode(e),o&&o.parentNode===this.element?this.element.insertBefore(l,o):this.element.appendChild(l),n&&r.appendChild(l)},Sactory.prototype.html=function(e,t){var n,r=this,o=t.top,a=t.bind,l=t.anchor,s=t.document,p=s.createElement("div"),i=function(e,t){p.innerHTML=e,n=Array.prototype.slice.call(p.childNodes,0),n.forEach(function(e){t&&t.parentNode===r.element?r.element.insertBefore(e,t):r.element.appendChild(e),o&&a.appendChild(e)})};if(Sactory.isObservable(e)){var d=Sactory.anchor({element:this.element,bind:a,anchor:l});e.subscribe({bind:a},function(e){n.forEach(function(e){return r.element.removeChild(e)}),i(e,d)}),i(e.value,d)}else i(e,l)},Sactory.prototype.className=function(e,t){var n=this;if(Sactory.isObservable(e)){var r=e.value;e.subscribe({bind:t},function(e){n.removeClassName(r),n.addClassName(r=e)}),this.addClassName(r),t&&t.addRollback(function(){return n.removeClassName(r)})}else this.addClassName(e),t&&t.addRollback(function(){return n.removeClassName(e)})},Sactory.prototype.classNameIf=function(e,t,n){var r=this;Sactory.isObservable(t)?(t.subscribe({bind:n},function(t){t?r.addClassName(e):r.removeClassName(e)}),t.value&&this.addClassName(e),n&&n.addRollback(function(){return t.value&&r.removeClassName(e)})):t&&(this.addClassName(e),n&&n.addRollback(function(){return r.removeClassName(e)}))},Sactory.prototype.addClassName=function(e){var t=this;e.split(" ").forEach(function(e){return t.element.classList.add(e)})},Sactory.prototype.removeClassName=function(e){var t=this;e.split(" ").forEach(function(e){return t.element.classList.remove(e)})},Sactory.prototype.addClassNamePolyfill=function(e){var t=this.element.getAttribute("class")||"";t.length&&(t+=" "),this.element.setAttribute(t+e)},Sactory.prototype.removeClassNamePolyfill=function(e){var t=this.element.getAttribute("class");if(t){t=t.split(" ");var n=t.indexOf(e);-1!=n&&(t.splice(n,1),this.element.setAttribute("class",t.join(" ")))}},Sactory.prototype.event=function(e,t,n){var r=e.split(":");e.args&&(r=r.map(function(e){return e.toValue()}));var o=r.shift(),a=t||function(){},l={};if(r.reverse().forEach(function(e){var t=a;if("function"==typeof e)a=function r(n){e.call(this,n)&&t.apply(this,arguments)};else switch(e){case"this":console.warn("Event modifier \":this\" does no longer work. Either bind the function yourself or use an arrow function to maintain the right scope.");break;case"noargs":a=function e(){return t.call(this)};break;case"prevent":a=function n(e){return e.preventDefault(),t.apply(this,arguments)};break;case"stop":a=function n(e){return e.stopPropagation(),t.apply(this,arguments)};break;case"once":l.once=!0;break;case"passive":l.passive=!0;break;case"capture":l.capture=!0;break;case"bubble":l.capture=!1;break;case"trusted":a=function n(e){if(e.isTrusted)return t.apply(this,arguments)};break;case"!trusted":a=function n(e){if(!e.isTrusted)return t.apply(this,arguments)};break;case"self":a=function n(e){if(e.target===this)return t.apply(this,arguments)};break;case"!self":a=function n(e){if(e.target!==this)return t.apply(this,arguments)};break;case"alt":case"ctrl":case"meta":case"shift":a=function r(n){if(n[e+"Key"])return t.apply(this,arguments)};break;case"!alt":case"!ctrl":case"!meta":case"!shift":e=e.substr(1),a=function r(n){if(!n[e+"Key"])return t.apply(this,arguments)};break;default:var n="!"!=e.charAt(0);n||(e=e.substr(1));var r,o,s,p=e.split(".");switch(p[0]){case"key":r=p.slice(1).map(function(e){e=e.toLowerCase(),Object.prototype.hasOwnProperty.call(Sactory.config.event.aliases,e)&&(e=Sactory.config.event.aliases[e]);var t=e.split("-");if(2==t.length){var n=_slicedToArray(t,2),r=n[0],o=n[1],a=void 0;if(1==r.length&&1==o.length?a=function(e){return e.toUpperCase().charCodeAt(0)}:"f"==r.charAt(0)&&"f"==o.charAt(0)&&(a=function(e){return 111+parseInt(e.substr(1))}),a){var l=a(r),s=a(o);return function(e){var t=e.keyCode||e.which;return t>=l&&t<=s}}}return"-"!=e&&(e=e.replace(/-/g,"")),function(t){return t.key.toLowerCase()==e}}),a=n?function n(e){for(var o in r)if(r[o](e))return t.apply(this,arguments)}:function n(e){for(var o in r)if(r[o](e))return;return t.apply(this,arguments)};break;case"code":r=p.slice(1).map(function(e){return e.toLowerCase().replace(/-/g,"")}),a=n?function n(e){if(-1!=r.indexOf(e.code.toLowerCase()))return t.apply(this,arguments)}:function n(e){if(-1==r.indexOf(e.code.toLowerCase()))return t.apply(this,arguments)};break;case"keyCode":case"key-code":r=p.slice(1).map(function(e){return parseInt(e)}),a=n?function n(e){if(-1!=r.indexOf(e.keyCode||e.which))return t.apply(this,arguments)}:function n(e){if(-1==r.indexOf(e.keyCode||e.which))return t.apply(this,arguments)};break;case"button":var i=p.slice(1).map(function(e){return"main"===e||"left"===e?0:"auxiliary"===e||"wheel"===e||"middle"===e?1:"secondary"===e||"right"===e?2:"fourth"===e||"back"===e?3:"fifth"===e||"forward"===e?4:parseInt(e)});a=n?function n(e){if(-1!=i.indexOf(e.button))return t.apply(this,arguments)}:function n(e){if(-1==i.indexOf(e.button))return t.apply(this,arguments)};break;case"location":var d=p.slice(1).map(function(e){return"standard"===e?0:"left"===e?1:"right"===e?2:"numpad"===e?3:parseInt(e)});a=n?function n(e){if(-1!=d.indexOf(e.location))return t.apply(this,arguments)}:function n(e){if(-1==d.indexOf(e.location))return t.apply(this,arguments)};break;case"throttle":if(0<=(o=parseInt(p[1])))a=function e(){s||(t.apply(this,arguments),s=!0,s=setTimeout(function(){return s=!1},o))};else throw new Error("Event delay must be higher or equals than 0.");break;case"debounce":if(0<=(o=parseInt(p[1])))a=function r(){var e=this,n=arguments;s&&clearTimeout(s),s=setTimeout(function(){s=0,t.apply(e,n)},o)};else throw new Error("Event delay must be higher or equals than 0.");break;default:throw new Error("Unknown event modifier '"+e+"'.");}}}),"documentappend"==o){o="append";var s=a,p=this.element;a=function r(e){if(O.contains(p.ownerDocument,p))s.call(p,e,p);else{for(var t=e.detail.parentNode;t.parentNode;)t=t.parentNode;t["~builder"].eventImpl("append",a,l,n)}}}else if(t){var i=a;a=function(e){i.call(this,e,this)}}this.eventImpl(o,a,l,n)},Sactory.prototype.eventImpl=function(e,t,n,r){var o=this;this.events[e]=!0,this.element.addEventListener(e,t,n),r&&r.addRollback(function(){return o.element.removeEventListener(e,t,n)})},Sactory.config.ie){var x=Sactory.prototype.eventImpl;Sactory.prototype.eventImpl=function(e,t,n,r){var o=n.capture,a=n.once;if(a){var l=t;t=function n(){l.apply(this,arguments),this.removeEventListener(e,t,o)}}x.call(this,e,t,o,r)}}Sactory.prototype[E.NONE]=function(e,t,n){var r=e.bind;this.attr(t.toString(),n,r)},Sactory.prototype[E.PROP]=function(e,t,n){var r=e.bind;this.prop(t.toString(),n,r)},Sactory.prototype[E.STYLE]=function(e,t,n){var r=e.bind;t=t.toString(),/[!a-z-]/.test(t.charAt(0))?this.style(t,n,r):this.complexStyle(t,n,r)},Sactory.prototype[E.EVENT]=function(e,t,n){var r=e.bind;this.event(t,n,r)},Sactory.prototype.bind=function(e,t,n,r,o){var a=e.bind,l=this,s=Sactory.isObservable(r),p=n.split("::"),i=p.shift(),d=Sactory.OUT_FORM_RANGE_START+Math.floor(Math.random()*Sactory.OUT_FORM_RANGE_LENGTH),c="SELECT"==this.element.tagName.toUpperCase(),m=void 0,u=void 0,y=[];t&&"value"!=t&&(this.element.type=t),c?this.element.multiple?(m=function(e){return e(Array.prototype.map.call(O.selectedOptions(l.element),function(e){return e.value}))},u=function(e){return Array.prototype.forEach.call(l.element.options,function(t){return t.selected=-1!=e.indexOf(t.value)})}):(m=function(e){return e(l.element.value)},u=function(e){return l.element.value=e}):"checkbox"==this.element.type?(m=function(e){return e(l.element.checked)},u=function(e){return l.element.checked=e}):"radio"==this.element.type?(m=function(e){return e(l.element.value)},u=function(e){return l.element.checked=e==l.element.value},s&&!this.element.name&&(this.element.name=r._radioGroupName||(r._radioGroupName=k.nextPrefix()))):(m=function(e){return e(l.element.value)},u=function(e){return l.element.value=null===e||void 0===e?"":e}),s?this.observe(a,r,u,d):u(r),p.length||(c||"checkbox"==this.element.type||"radio"==this.element.type?p.push("change"):p.push("input")),i&&i.split(":").forEach(function(e){return e.args&&(e=e.toValue(),"function"==typeof e)?void y.push(e):void y.push(function(){switch(e){case"number":case"num":case"float":return function(){return+this};case"int":case"integer":return function(){return v.trunc(+this)};case"str":case"string":return function(){return this+""};case"date":switch(l.element.type){case"date":case"month":return function(){var e=this.split("-");return new Date(e[0],e[1]-1,e[2]||1)};case"time":return function(){var e=this.split(":"),t=new Date;return t.setHours(e[0]),t.setMinutes(e[1]),t.setSeconds(0),t.setMilliseconds(0),t};default:return function(){return new Date(this)};}case"comma":return function(){return this.replace(/,/g,".")};case"trim":return String.prototype.trim;case"trim-left":case"trim-start":return v.trimStart;case"trim-right":case"trim-end":return v.trimEnd;case"lower":case"lowercase":return String.prototype.toLowerCase;case"upper":case"uppercase":return String.prototype.toUpperCase;case"capital":case"capitalize":return function(){return this.charAt(0).toUpperCase()+this.substr(1)};default:throw new Error("Unknown value modifier '"+e+"'.");}}())}),s?y.push(function(e){r.currentType=d,o(e),delete r.currentType}):y.push(o),p.forEach(function(e){l.event(e,function(){m(function(e){return y.forEach(function(t){return e=t.call(e,e)})})},a)})},Object.getOwnPropertyDescriptor(Element.prototype,"classList")?(Sactory.prototype.addClass=function(e){this.element.classList.add(e)},Sactory.prototype.removeClass=function(e){this.element.classList.remove(e)}):(Sactory.prototype.addClass=function(e){-1!=!this.element.className.split(" ").indexOf(e)&&(this.element.className=(this.element.className+" "+e).trim())},Sactory.prototype.removeClass=function(e){this.element.className=this.element.className.split(" ").filter(function(t){return t!=e}).join(" ")}),Sactory.prototype.dispatchEvent="function"==typeof CustomEvent?function(e,t){var n=t.bubbles,r=t.cancelable,o=t.detail,a=new CustomEvent(e,{bubbles:n,cancelable:r,detail:o});return this.element.dispatchEvent(a),a}:function(e,t){var n=t.bubbles,r=t.cancelable,o=t.detail,a=document.createEvent("Event");return a.initEvent(e,n,r),a.detail=o,this.element.dispatchEvent(a),a};var O={};O.contains=function(e,t){return!!t.parentNode&&(t.parentNode===e||O.contains(e,t.parentNode))},O.selectedOptions="function"==typeof HTMLSelectElement&&Object.getOwnPropertyDescriptor(HTMLSelectElement.prototype,"selectedOptions")?function(e){return e.selectedOptions}:function(e){return Array.prototype.filter.call(e.options,function(e){return e.selected})},n.prototype.reset=function(){this.count=this.init},n.prototype.nextId=function(){return++this.count},n.prototype.nextPrefix=function(){return Sactory.config.prefix+this.nextId()},n.prototype.nextBind=function(){return this.bind++},n.prototype.nextObservable=function(){return this.observable++},n.prototype.nextSubscription=function(){return this.subscription++};var k=new n(function(){var e;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.dataset.sactory&&(e=+document.documentElement.dataset.sactory,document.documentElement.removeAttribute("data-sactory")),e||0}());r.all=function(e,t){for(var n=arguments.length,r=Array(2<n?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];var a=_toArray(t),l=a[0],s=a.slice(1),p=Sactory.newChainContext(e);return p.all=!0,l.call.apply(l,[null,p].concat(_toConsumableArray(s))),Array.prototype.forEach.call(p.elements,function(e){r.forEach(function(t){var n=_toArray(t),r=n[0],o=n.slice(1);return r.call.apply(r,[null,v.assign({},p,{element:e})].concat(_toConsumableArray(o)))})}),p.elements},r.nop=function(e){e.element=e.parentElement},r.use=function(e,t){e.all?e.elements=t:e.element=t},r.query=function(e,t,n){var o=n||e.parentElement||e.document||document;r.use(e,o[e.all?"querySelectorAll":"querySelector"](t))},r.slot=function(e,t,n){var r,o=e.registry;do{var a=n||o.main,l=o.slots[a];l&&(r=l[t||Sactory.SL_CONTENT])}while(!r&&(o=o.parent));r&&v.assign(e,r)},r.clone=function(e,t){var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];e.element=t.cloneNode(n)},r.clear=function(e){for(var t,n=Sactory.currentElement(e);t=n.lastChild;)n.removeChild(t)},r.namespace=function(e,t){e.namespace=t},r.updateImpl=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],a=[],l={},s=[],p={},i=function(e,t,n){if(e>=E.WIDGET){var r;if(e>=E.UPDATE_WIDGET){if("function"==typeof t[0]){var o=t[0];if(t=t.slice(1).toString().substr(1),t.length)s.push({widget:o,args:r={}});else return void s.push({widget:o,args:n})}else{t=t.toString();var d=t.indexOf(":");if(-1==d)return void s.push({name:t,args:p[t]=n});var c=t.substring(0,d);e==E.UPDATE_WIDGET?s.push({name:c,args:r={}}):Object.prototype.hasOwnProperty.call(p,c)?r=p[c]:s.push({name:c,args:r=p[c]={}}),t=t.substr(d+1)}}else if(t=t.toString(),t.length)r=l;else return void(l=n);var m=t.split(".");if(1<m.length){for(var u,y=0;y<m.length-1;y++)u=m[y],"object"!=_typeof(r[u])&&(r[u]={}),r=r[u];r[m[m.length-1]]=n}else r[t]=n}else a.push({type:e,name:t,value:n})};r.forEach(function(e){var n=_toArray(e),r=n[0],o=n.slice(1),a=r>>3,l=7&r;if(a==E.NORMAL){var t=_slicedToArray(o,3),s=t[0],p=t[1],d=t[2];d&&void 0===p||i(l,s,p)}else if(a==E.INTERPOLATED){var c=_slicedToArray(o,4),m=c[0],u=c[1],y=c[2],h=c[3];m||y?u.forEach(function(e){return i(l,m+e+y,h)}):u.forEach(function(e){return i(l,e,h)})}else{var b=_slicedToArray(o,1),g=b[0];for(var f in g)i(l,f,g[f])}});var d=e.container||e.element,c=new u(e.registry);if(!d){var m,y={name:n||t};if(o&&(m=Sactory.getFunctionWidget(t,e.registry,y))){var h=c.sub(y.name,!0),b=Sactory.newContext(e,{element:null,anchor:null,registry:h});if(m.prototype&&m.prototype.render){var g=Widget.newInstance(m,b,l);c.widgets.main=c.widgets.named[y.name]=g;var f=Widget.render(m,g,b,l);f["~builder"].widget=f["~builder"].widgets[y.name]=g,e.element=f}else if(e.element=m.call(y.parentWidget,l,l,b),!(e.element instanceof Node))throw new Error("The widget did not return an instance of 'Node', returned '"+e.element+"' instead.");if(h.targetSlots[Sactory.SL_CONTENT]){var v=h.targetSlots[Sactory.SL_CONTENT];e.content=v.element||v.anchor.parentNode,e.anchor=v.anchor}else e.content=e.element;d=e.element,h.targetSlots[Sactory.SL_CONTAINER]&&(d=e.container=h.targetSlots[Sactory.SL_CONTAINER].element),h.targetSlots[Sactory.SL_INPUT]&&(e.input=h.targetSlots[Sactory.SL_INPUT].element)}else{var w=function(t){return d=e.element=e.content=t};e.namespace?w(e.document.createElementNS(e.namespace,t)):"svg"==t?w(e.document.createElementNS(e.namespace="http://www.w3.org/2000/svg",t)):w(e.document.createElement(t))}}a.sort(function(e,t){return e.type-t.type}),a.forEach(function(t){var n=t.type,r=t.name,o=t.value;return d["~builder"][n](e,r,o)}),s.forEach(function(t){var n=t.widget,r=t.name,o=t.args,a={name:r};if(!n&&(n=Sactory.getWidget(r,e.registry,a),!n))throw new Error("Widget '"+r+"' could not be found.");var l=c.sub(a.name||"",!1),s=Sactory.newContext(e,{anchor:null,registry:l});if(n.prototype&&n.prototype.render){var p=Widget.newInstanceRender(n,s,o),i=p.instance,m=p.element;if(m!==d)throw new Error("The widget did not return the given element, hence does not support extension.");a.name&&(c.widgets.named[a.name]=d["~builder"].widgets[a.name]=i)}else a.parentWidget?n.call(a.parentWidget,o,o,s):n(o,o,s)}),e.registry=c},r.update=function(e,t,n){e.element||(e.element=e.parentElement),r.updateImpl(e,null,null,t,n)},r.create=function(e,t,n,o,a){e.anchor=null,e.created=!0,r.updateImpl(e,t,n,o,a)},r.createIf=function(e,t,n,o,a){e.parentElement?r.update(e,o,a):r.create(e,t,n,o,a)},r.ref=function(e){Array.prototype.slice.call(arguments,1).forEach(function(t){return t(e.element)})},r.refWidget=function(e){var t=e.element["~builder"].widget;Array.prototype.slice.call(arguments,1).forEach(function(e){return e(t)})},r.slots=function(e,t){t.forEach(function(t){return e.registry.add(null,t,e.element)})},r.text=function(e,t){Sactory.currentElement(e)["~builder"].text(t,e)},r.html=function(e,t){Sactory.currentElement(e)["~builder"].html(t,e)},r.mixin=function(e,t){t instanceof Node?r.appendTo({element:t,top:e.top,bind:e.bind,parentAnchor:e.anchor},Sactory.currentElement(e)):t&&r.html(e,t)},r.body=function(e,t){var n=e.content||e.element||e.parentElement;t(Sactory.newContext(e,{slot:e.element,element:n,document:e.document||n.ownerDocument,top:e.top&&!e.created}))},r.bind=function(e){var n=e.input||e.content;Array.prototype.slice.call(arguments,1).forEach(function(r){var o=_slicedToArray(r,4),a=o[0],l=o[1],s=o[2],p=o[3],i=e.registry.widgets.main;if(i){var c=Object.getPrototypeOf(i);if(c.bind$)return void i.bind$(a,{info:l,value:s,update:p},e);var d=c["bind$"+a]||c["bind$"+t(a)];if(d)return void d.call(i,{info:l,value:s,update:p},e)}n["~builder"].bind(e,a,l,s,p)})},r.appendTo=function(e,t){e.top&&(e.element instanceof DocumentFragment?Array.prototype.forEach.call(e.element.childNodes,function(t){return e.bind.appendChild(t)}):e.bind.appendChild(e.element)),e.parentAnchor&&e.parentAnchor.parentNode===t?t.insertBefore(e.element,e.parentAnchor):t.appendChild(e.element),e.element["~builder"]&&e.element["~builder"].events.append&&e.element["~builder"].dispatchEvent("append",{bubbles:!1,detail:{parentNode:t}})},r.append=function(e){e.parentElement&&r.appendTo(e,e.parentElement)},r.appendToIf=function(e,t){e.created&&r.appendTo(e,t)},r.appendIf=function(e,t){e.created&&r.append(e,t)},Sactory.chain=r,Object.defineProperty(Node,"ANCHOR_NODE",{writable:!1,enumerable:!0,configurable:!1,value:99}),Sactory.NS_XHTML="http://www.w3.org/1999/xhtml",Sactory.NS_SVG="http://www.w3.org/2000/svg",Sactory.NS_MATHML="http://www.w3.org/1998/mathml",Sactory.NS_XUL="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul",Sactory.NS_XBL="http://www.mozilla.org/xbl",Sactory.SL_CONTAINER="__container",Sactory.SL_CONTENT="__content",Sactory.SL_INPUT="__input",Sactory.OUT_ARRAY_SET=1048570,Sactory.OUT_ARRAY_PUSH=1048571,Sactory.OUT_ARRAY_POP=1048572,Sactory.OUT_ARRAY_UNSHIFT=1048573,Sactory.OUT_ARRAY_SHIFT=1048574,Sactory.OUT_ARRAY_SPLICE=1048575,Sactory.OUT_FORM_RANGE_START=1048576,Sactory.OUT_FORM_RANGE_LENGTH=1048576;var A="undefined"==typeof document?void 0:document;Sactory.contextFromArguments=Sactory.cfa=function(e,t,n){for(var r,o=t.length;o>n;o--)if(r=t[o-1],r&&r.__context)return r;return e},Sactory.newContext=function(e,t){return v.assign({__context:!0},e,t)},Sactory.newChainContext=function(e){return function(e){var t=e.element,n=e.namespace,r=e.top,o=e.bind,a=e.anchor,l=e.registry,s=e.selector,p=e.document;return{__context:!0,namespace:n,top:r,bind:o,anchor:a,registry:l,selector:s,parentElement:t,parentAnchor:a,document:p||t&&t.ownerDocument||A}}(e)},Sactory.newBindContext=function(e,t,n){return Sactory.newContext(e,{element:n&&n.parentNode,top:!0,bind:t,anchor:n})},Sactory.currentElement=function(e){return e.content||e.container||e.element||e.parentElement},o(Window),o(Document),o(Element),o(DocumentFragment),"function"==typeof ShadowRoot&&o(ShadowRoot),Window.prototype.$$on=Document.prototype.$$on=Element.prototype.$$on=function(e,t,n){Sactory.$$on(e,this,t,n)},l.prototype.get=function(e){return this.args[e]},l.prototype.slice=function(){return new l(Array.prototype.slice.apply(this.args,arguments))},l.prototype.split=function(e){var t,n=[],r=function(e){t||n.push(t=[]),t.push(e)};return this.args.forEach(function(n){if("function"==typeof n)r(n);else{var o=(n+"").split(e);if(o.length&&(o[0].length||(t=null,o.shift()),o.length)){var a=o.pop();o.forEach(function(e){r(e),t=null}),a.length&&r(a)}}}),n.map(function(e){return new l(e)})},l.prototype.toValue=function(){return 1==this.args.length?this.args[0]:this.toString()},l.prototype.toString=function(){return this.args.join("")},Sactory.check=function(e,t){var n=e.split("."),r=Sactory.VERSION.split(".");if(n[0]!=r[0]||n[1]!=r[1])if(t)console.warn("Code transpiled using version "+e+" may not work properly in the current runtime environment using version "+Sactory.VERSION+".");else throw new Error("Code transpiled using version "+e+" cannot be run in the current runtime environment using version "+Sactory.VERSION+".")},Sactory.document=function(e){if(e.document)return e.document;if("undefined"!=typeof document)return document;throw new Error("No document associated to the current context.")},Sactory.documentElement=function(e){return Sactory.document(e).documentElement},Sactory.root=function(e,t){return e.element?e.element.getRootNode({composed:t}):Sactory.document(e)},Sactory.head=function(e){return Sactory.document(e).head},Sactory.body=function(e){return Sactory.document(e).body},Sactory.unique=function(e,t,n){var r="unique-"+Sactory.config.prefix+t;if(!(e.document||document).querySelector("."+r)){var o=n();return o["~builder"].addClass(r,e.bind),o}},Sactory.inherit=function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return n.reverse().forEach(function(t){for(var n,r=0;r<Math.min(3,t.length);r++)if(n=t[r],n){var o;e[r]?(o=e[r]).unshift.apply(o,_toConsumableArray(n)):e[r]=n}}),e},Sactory.$$on=function(e,t,n,r){t["~builder"].event(n,r,e.bind)},Sactory.$$bindInput=function(e,t,n,r){var o=r.info,a=r.value,l=r.update;t["~builder"].bind(e,n,o,a,l)},Sactory.attr=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return new l(t)},Sactory.forEachArray=function(e,t){e.forEach(t)},Sactory.forEachObject=function(e,t){var n=0;for(var r in e)t(r,e[r],n++,e)},Sactory.range=function(e,t,n){if(e<t)for(;e<t;)n(e++);else for(;e>t;)n(e--)},Sactory.stringify=function(e,t,n){switch("undefined"==typeof e?"undefined":_typeof(e)){case"number":return e.toString(t||10);case"function":return e.toString();case"undefined":return"undefined";default:return JSON.stringify(e,t,n);}},Sactory.quote=function(e){return JSON.stringify(e+"")},Sactory.ready=function(e){"complete"==document.readyState?e():window.addEventListener("load",e)};var T="function"==typeof setImmediate?setImmediate:setTimeout;Subscription.prototype.dispose=function(){this.disposed=!0,this.observed.unsubscribe(this)},Observable.prototype.subscribeImpl=function(e,t){return this._subscriptions.push(t),e&&e.bind&&e.bind.subscribe(t),t},Observable.prototype.subscribe=function(e,t,n){this.subscribeImpl(e,new Subscription(this,null,t,n))},Observable.prototype.depend=function(e,t,n){return this.subscribeImpl(e,new Subscription(this,n,t))},Observable.prototype.unsubscribe=function(e){for(var t,n=e.id,r=0;r<this._subscriptions.length;r++)if(t=this._subscriptions[r],t.id==n)return this._subscriptions.splice(r,1),!0;return!1},Observable.prototype.$$subscribe=function(e,t,n){return this.subscribe(e,t,n)},Observable.prototype.propagateUpdate=function(e,t,n,r){this._subscriptions.forEach(function(o){o.type&&o.type==n||o.callback(e,t,n,r)})},Observable.prototype.triggerUpdate=function(e,t){this.propagateUpdate(this._value,this._value,e,t)},Observable.prototype.update=function(e,t,n){if(this.shouldUpdate(this._value,e)){var r=this._value;this._value=this.wrapValue(e),this.propagateUpdate(e,r,t||this.currentType,n)}},Observable.prototype.shouldUpdate=function(e,t){return e!==t},Observable.prototype.wrapValue=function(e){return e instanceof Observable&&(e=e.value),Array.isArray(e)||e instanceof Observable.Array?new Observable.Array(this,e):e},Object.defineProperty(Observable.prototype,"value",{configurable:!0,get:function e(){return this._value},set:function t(e){this.update(e)}}),Observable.prototype.valueOf=function(){return this._value},Observable.prototype.toJSON=function(){return this._value&&this._value.toJSON?this._value.toJSON():this._value},Observable.prototype.toString=function(){return this._value+""},Observable.prototype.storage=function(e,t,n){this._key=t+(n?"__v"+n:"");var r=this.propagateUpdate;Object.defineProperty(this,"propagateUpdate",{value:function n(t){e.setItem(this._key,JSON.stringify(t)),r.apply(this,arguments)}});var o=e.getItem(this._key);return o&&(this.value=JSON.parse(e.getItem(this._key))),this};var R=function(e){return function(t){return console.warn(e+" is not available. Observable assigned to key '"+t+"' will not be saved to it."),this}};Observable.prototype.localStorage="undefined"==typeof localStorage?R("localStorage"):function(e,t){return this.storage(localStorage,e,t)},Observable.prototype.sessionStorage="undefined"==typeof sessionStorage?R("sessionStorage"):function(e,t){return this.storage(sessionStorage,e,t)},Observable.prototype.nowrap=function(){return Object.defineProperty(this,"wrapValue",{value:function t(e){return e}}),this},Observable.prototype.always=function(){return Object.defineProperty(this,"shouldUpdate",{value:function e(){return!0}}),this},Observable.prototype.async=function(){var e=this,t=this._calc;return this._calc=function(){e._updating||(e._updating=!0,T(function(){e._updating=!1,t()}))},this},Observable.prototype.transform=function(e){if(this.converters)this.converters.push(e);else{this.converters=[e];var t=this.wrapValue;Object.defineProperty(this,"wrapValue",{value:function n(e){return this.converters.forEach(function(t){return e=t(e)}),t.call(this,e)}})}return this},Observable.prototype.validate=function(e,t){return this.transform(function(n){return e(n)?n:t})},Observable.Array=function(e){function Array(t,n){e.call(this),e.prototype.push.apply(this,n),Object.defineProperty(this,"observable",{enumerable:!1,value:t});var r=this.length;Object.defineProperty(this,"length",{configurable:!1,enumerable:!1,writable:!0,value:r})}return Array.prototype=Object.create(e.prototype),[{name:"copyWithin"},{name:"fill"},{name:"pop",type:Sactory.OUT_ARRAY_POP},{name:"push",type:Sactory.OUT_ARRAY_PUSH},{name:"reverse"},{name:"shift",type:Sactory.OUT_ARRAY_SHIFT},{name:"sort"},{name:"splice",type:Sactory.OUT_ARRAY_SPLICE},{name:"unshift",type:Sactory.OUT_ARRAY_UNSHIFT}].forEach(function(t){var n=t.name,r=t.type;e.prototype[n]&&Object.defineProperty(Array.prototype,n,{enumerable:!1,value:function o(){var t=e.prototype[n].apply(this,arguments);return this.observable.triggerUpdate(r,arguments),t}})}),Object.defineProperty(Array.prototype,"set",{value:function n(e,t){return this[e]=t,this.observable.triggerUpdate(Sactory.OUT_ARRAY_SET,[e,t]),t}}),Object.defineProperty(Array.prototype,"toJSON",{value:function t(){return e.apply(null,this)}}),Array}(Array),ComputedObservable.prototype=Object.create(Observable.prototype),ComputedObservable.prototype.recalc=function(){for(var e in this.odeps=v.assign({},this.deps),this.value=this.fun(this.tracker),this.odeps)this.ndeps[e]||this.odeps[e].dispose();this.deps=this.ndeps,this.odeps=this.ndeps={}},s.prototype.add=function(e){var t=this,n=e.id;this.observable.ndeps[n]=this.observable.deps[n]?this.observable.deps[n]:e.depend(this.context,function(){return t.observable.recalc()},this.observable)},s.prototype.a=function(e){return this.add(e),e.value},s.prototype.b=function(e){return Sactory.isObservable(e)?this.a(e):e},s.prototype.c=function(e,t){return this.add(e),t(this,e.value)},s.prototype.d=function(e,t){return Sactory.isObservable(e)?this.c(e,t):t(this,e)},Sactory.cofv=function(e){return new Observable(e)},Sactory.coff=function(e,t){return new ComputedObservable(e,t)},Sactory.isObservable=function(e){return e instanceof Observable},Sactory.value=function(e){return Sactory.isObservable(e)?e.value:e},Sactory.Subscription=Subscription,Sactory.Observable=Observable,Builder.prototype.select=function(e){var t=this;if("@"==e.charAt(0)){var n=[],r=n;return this.root.push({selector:e,tree:n}),this.selectors.length&&(r=[],n.push({selector:this.selectors.join(", "),tree:r})),new Builder(this.root,n,r,this.selectors,"keyframes"==e.substr(1,9))}var o=[];e.split(",").map(function(e){return e.trim()}).forEach(function(e){-1==e.indexOf("&")?t.selectors.length&&!t.absolute?t.selectors.forEach(function(t){return o.push(t+" "+e)}):o.push(e):t.selectors.forEach(function(t){return o.push(e.replace(/&/g,t))})});var a=[];return this.sroot.push({selector:o.join(", "),tree:a}),new Builder(this.root,this.sroot,a,o)},Builder.prototype.value=function(e,t){var n=this;e.split(",").map(function(e){return n.tree.push({key:e.trim(),value:t})})},Builder.prototype.stat=function(e){this.root.push({stat:e})},Builder.prototype.spread=function(e){for(var t in e)this.value(t,e[t])},Builder.minify=function(e){var t="";return e.forEach(function(e){e.selector?e.tree.length&&(t+=e.selector+"{"+Builder.minify(e.tree)+"}"):e.stat?t+=e.stat+";":t+=e.key+":"+e.value+";"}),t},Builder.prettify=function(e,t,n){var r="";return e.forEach(function(e){if(e.selector){var o=e.selector,a=e.tree;a.length&&(r+=t+o+" {\n"+Builder.prettify(a,t+n,n)+t+"}\n")}else r+=e.stat?t+e.stat+";\n":t+e.key+": "+e.value+";\n"}),r};var P=["px","%","rem","em","s","pt","vh","vw","vmin","vmax","cm","mm","in","pc","ex","ch"];Sactory.computeUnit=Sactory.cu=function(e){var t="",n=e(function(e){if("string"==typeof e)for(var n in P){var r=P[n];if(v.endsWith.call(e,r)){var o=+e.slice(0,-r.length);if(!isNaN(o))if(t&&t!=r)throw new Error("Units '"+t+"' and '"+r+"' are not compatible. Use the calc() css function instead.");else return t=r,o}}return e});return"number"==typeof n?Math.round(1e4*n)/1e4+t:n},Sactory.cabs=function(e,t,n){var r=e.element,o=e.bind,a=e.selector;if(!a)if(1===t){var s=r["~builder"].scopedClassName=k.nextPrefix();a="."+s}else t&&(a=t);var l=function(e){var t=[],n=t,o=[];a&&(n=[],t.push({tree:n,selector:a}),o.push(a)),e(new Builder(t,t,n,o),Sactory.css),r.textContent=Builder.minify(t)};Sactory.isObservable(n)?(n.$$subscribe({bind:o},l),l(n.value)):l(n)},Sactory.scope=function(e){var t=e.element,n=e.bind,r=t["~builder"],o=r.scopedClassName,a=function(){var e=t.parentNode["~builder"];e.addClass(o),n&&n.addRollback(function(){return e.removeClass(o)})};t.parentNode?a():r.event("append",a,n)},Sactory.css={},Color.prototype.toJSON=function(){return this.toString()},RGBColor.prototype=Object.create(Color.prototype),RGBColor.prototype.update=function(e){this.r=e(this.r,"r"),this.g=e(this.g,"g"),this.b=e(this.b,"b")},RGBColor.prototype.toHSL=function(){var e,t,n=Math.min(this.r,this.g,this.b),r=Math.max(this.r,this.g,this.b),o=(r+n)/2;if(r==n)e=t=0;else{var a=r-n;t=.5<o?a/(2-r-n):a/(r+n),e=0==a?0:r==this.r?(this.g-this.b)/a%6:r==this.g?(this.b-this.r)/a+2:(this.r-this.g)/a+4,e/=6}return new HSLColor(e,t,o,this.a)};var I=function(e){return Math.round(255*e)},U=function(e){return v.padStart.call(e.toString(16),2,"0")};RGBColor.prototype.toHexString=function(){return"#"+[this.r,this.g,this.b].map(I).map(U).join("")},RGBColor.prototype.toRGBString=function(){return"rgb("+[this.r,this.g,this.b].map(I).join(", ")+")"},RGBColor.prototype.toRGBAString=function(){return"rgba("+[this.r,this.g,this.b].map(I).join(", ")+", "+this.a+")"},RGBColor.prototype.toString=function(){return 1==this.a?this.toHexString():this.toRGBAString()},RGBColor.fromHexString=function(e){return 3==e.length?new(Function.prototype.bind.apply(RGBColor,[null].concat(_toConsumableArray(e.split("").map(function(e){return parseInt(e,16)/15}))))):new(Function.prototype.bind.apply(RGBColor,[null].concat(_toConsumableArray(e.match(/.{2}/g).map(function(e){return parseInt(e,16)/255})))))},RGBColor.from=function(e){return e instanceof RGBColor?new RGBColor(e.r,e.g,e.b,e.a):e.toRGB?e.toRGB():RGBColor.from(p(e))},HSLColor.prototype=Object.create(Color.prototype),HSLColor.prototype.toHSLString=function(){return"hsl("+Math.round(360*this.h)+", "+Math.round(100*this.s)+"%, "+Math.round(100*this.l)+"%)"},HSLColor.prototype.toHSLAString=function(){return"hsla("+Math.round(360*this.h)+", "+Math.round(100*this.s)+"%, "+Math.round(100*this.l)+"%, "+this.a+")"},HSLColor.prototype.toString=function(){return 1==this.a?this.toHSLString():this.toHSLAString()},HSLColor.prototype.toRGB=function(){var e,t,n,o=(1-Math.abs(2*this.l-1))*this.s,a=o*(1-Math.abs(6*this.h%2-1)),l=this.l-o/2;return this.h<1/6?(e=o,t=a,n=0):this.h<2/6?(e=a,t=o,n=0):this.h<3/6?(e=0,t=o,n=a):this.h<4/6?(e=0,t=a,n=o):this.h<5/6?(e=a,t=0,n=o):(e=o,t=0,n=a),new RGBColor(e+l,t+l,n+l,this.a)},HSLColor.from=function(e){return e instanceof HSLColor?new HSLColor(e.h,e.s,e.l,e.a):e.toHSL?e.toHSL():HSLColor.from(p(e))};var L=function(e){return e.slice(0,-1)/100},W="object"==("undefined"==typeof colors?"undefined":_typeof(colors))?function(e){return Object.prototype.hasOwnProperty.call(colors,e)?RGBColor.fromHexString(colors[e]):new RGBColor(0,0,0)}:function(e){var t=document.createElement("div");return t.style.color=e,document.head.appendChild(t),e=window.getComputedStyle(t).color,document.head.removeChild(t),p(e)};Sactory.css.rgb=function(e){return arguments.length?(e=RGBColor.from(p(e)),e.a=1,e):d(RGBColor,!1)},Sactory.css.rgba=function(e,t){return arguments.length?(e=RGBColor.from(e),1<arguments.length&&(e.a=t),e):d(RGBColor,!0)},Sactory.css.hsl=function(e){return arguments.length?(e=HSLColor.from(e),e.a=1,e):d(HSLColor,!1)},Sactory.css.hsla=function(e,t){return arguments.length?(e=HSLColor.from(e),1<arguments.length&&(e.a=t),e):d(HSLColor,!0)},Sactory.css.red=c(RGBColor.from,"r"),Sactory.css.green=c(RGBColor.from,"g"),Sactory.css.blue=c(RGBColor.from,"b"),Sactory.css.hue=c(HSLColor.from,"h"),Sactory.css.saturation=c(HSLColor.from,"s"),Sactory.css.lightness=c(HSLColor.from,"l"),Sactory.css.alpha=c(p,"a"),Sactory.css.lighten=function(e,t){return e=HSLColor.from(e),e.l+=(1-e.l)*t,e},Sactory.css.darken=function(e,t){return e=HSLColor.from(e),e.l*=1-t,e},Sactory.css.saturate=function(e,t){return e=HSLColor.from(e),e.s+=(1-e.s)*t,e},Sactory.css.desaturate=function(e,t){return e=HSLColor.from(e),e.s*=1-t,e},Sactory.css.grayscale=Sactory.css.greyscale=function(e){return e=RGBColor.from(e),e.r=e.g=e.b=.2989*e.r+.587*e.g+.114*e.b,e},Sactory.css.invert=function(e){return e=RGBColor.from(e),e.update(function(e){return 1-e}),e},Sactory.css.pastel=function(e){return arguments.length?(e=HSLColor.from(e),e.s=.9+.1*e.s,e.l=.75+.15*e.l,e):new HSLColor(Math.random(),.9+.1*Math.random(),.75+.15*Math.random())},Sactory.css.sepia=function(e){return e=RGBColor.from(e),new RGBColor(.393*e.r+.769*e.g+.189*e.b,.349*e.r+.686*e.g+.168*e.b,.272*e.r+.534*e.g+.131*e.b,e.a)},Sactory.css.mix=function(){var e=arguments.length,t=new RGBColor(0,0,0);return Array.prototype.forEach.call(arguments,function(e){RGBColor.from(e).update(function(e,n){t[n]+=e})}),t.update(function(t){return t/e}),t},Sactory.css.contrast=function(e,t,n){return e=RGBColor.from(e),e.update(function(e){return .03928>=e?e/12.92:Math.pow((e+.055)/1.055,2.4)}),.179<.2126*e.r+.7152*e.g+.0722*e.b?n||"#000":t||"#fff"};var H={};Sactory.addWidget=function(e,t){var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];m(e,t,function(e,t){if(Object.prototype.hasOwnProperty.call(H,e))throw new Error("Widget \""+e+"\" already registered. Either specify a different name or use \"replaceWidget\" instead.");else n?H[e]=t:Object.defineProperty(H,e,{value:t})})},Sactory.replaceWidget=function(e,t){m(e,t,function(e,t){var n=Object.getOwnPropertyDescriptor(H,e);if(n&&!n.configurable)throw new Error("Widget \""+e+"\" cannot be replaced.");else H[e]=t})},Sactory.removeWidget=function(t){"string"!=typeof t&&(t=e(t.name)),delete H[t]},Sactory.hasWidget=function(e){return Object.prototype.hasOwnProperty.call(H,e)},Sactory.getWidget=function(e,n){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},o=e.indexOf("$");if(-1==o)return Object.prototype.hasOwnProperty.call(H,e)&&H[e];var a,l=e.substring(0,o);if(n){var s=n;if(l)do a=s.widgets.named[l];while(!a&&(s=s.parent));else do a=s.widgets.main;while(!a&&(s=s.parent))}return r.parentWidget=a,r.parentName=l,r.name=e.substr(o+1),a&&(a["render$"+r.name]||a["render$"+t(r.name)])},Sactory.getFunctionWidget=function(e,t,n){return"function"==typeof e?e:Sactory.getWidget(e,t,n)},Sactory.getWidgetsNames=function(){return Object.keys(H)},Sactory.widget=function(e,t){return e["~builder"]&&(t?e["~builder"].widgets[t]:e["~builder"].widget)||null},Sactory.widgetSelector=function(e,t){var n=document.querySelector(e);return n&&Sactory.widget(n,t)},Widget.prototype.element=null,Widget.prototype.render=function(){var e=document.createElement("p");return e.style.color="red",e.style.fontFamily="monospace",e.innerHTML="The widget's <b>render</b> function is not implemented.",e},Widget.prototype.dispatchEvent=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!this.element)throw new Error("Cannot dispatch event: the widget has not been rendered yet.");this.element["~builder"].dispatchEvent(e,t)},Widget.newInstance=function(e,t,n){return new e(n,n,t)},Widget.render=function(e,t,n,r){var o=t.__element=t.render(r,r,n);if(t instanceof Widget&&(t.element=o),!(o instanceof Node))throw new Error("The widget's render function did not return an instance of 'Node', returned '"+o+"' instead.");return e.style&&Widget.createStyle({document:n.document},e,o),e.prototype.style&&Widget.createStyle(n,t,o),o},Widget.createStyle=function(e,t,n){var r=t.__styled;r||(t.__styled=r=k.nextPrefix(),t.style(Sactory.newContext(e,{selector:"."+r,element:e.document.head}))),n["~builder"].addClass(r)},Widget.newInstanceRender=function(e,t,n){var r=Widget.newInstance(e,t,n);return{instance:r,element:Widget.render(e,r,t,n)}},Sactory.Widget=Widget,u.prototype.sub=function(e,t){var n=new u(this.parent);return n.widgets=this.widgets,n.slots=this.slots,n.targetSlots=this.slots[e]={},t&&(this.main=e),n},u.prototype.add=function(e,t,n){this.targetSlots[t||Sactory.SL_CONTENT]={anchor:e,element:n}},Sactory.classes=function(){var e=Array.prototype.slice.call(arguments,0);return function(t,n,r){var o=r.element,a=r.bind,l=o["~builder"];return e.forEach(function(e){return l.className(e,a)}),o}},Sactory.widgets={};var $,D="undefined"!=typeof document&&document.implementation?function(e,t){return document.implementation.createDocument(e,t)}:function(e,t){return new XMLDocument(e,t)};return y("document-fragment",function(e,t,n){return Sactory.document(n).createDocumentFragment()},!1),y("shadow-root",function(e,t,n){var r=e.mode,o=void 0===r?"open":r,a=n.element||Sactory.document(n).createElement("div");return n.registry.add(null,"",a.attachShadow({mode:o})),a},!0),y("xml",function(e,t,n){var r=e.namespace,o=e.root,a=e.name,l=n.registry,s=D(r,o||a||"xml");return l.add(null,Sactory.SL_CONTENT,s.firstElementChild),l.add(null,Sactory.SL_CONTAINER,s.firstElementChild),s},!1),y("text",function(e,t,n){return n.anchor=n.parentAnchor,n.element["~builder"].text(e,n),n.element},!0),y("html",function(e,t,n){return n.anchor=n.parentAnchor,n.element["~builder"].html(e,n),n.element},!0),y("class",h,!0),y("next",function(e,t,n){$=k.nextPrefix(),b(e,t,n)},!0),y("prev",b,!0),y("hide",function(e,t,n){var r=n.element,o=n.bind;g(r,e,0,o)},!0),y("show",function(e,t,n){var r=n.element,o=n.bind;g(r,e,1,o)},!0),Sactory});
//# sourceMappingURL=maps/sactory.min.js.map
